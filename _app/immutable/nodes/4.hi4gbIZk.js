import{B as pe,C as me,x as L,m as _e,r as ne,a as le,f as ae,h as X,d as oe,n as H,e as Y,i as be,o as ge}from"../chunks/scheduler.CWFRzsjZ.js";import{A as O,l as T,y as z,t as q,S as ce,i as re,e as U,o as G,s as A,c as ie,a as x,b as D,p as K,g,f as R,d as he,h as k,j as $,k as P,m as ue,w as N,v as Q,n as fe,r as E,C as ve,x as B}from"../chunks/index.DWCIZltW.js";import{b as F}from"../chunks/paths.CNms3DRf.js";import{d as de,l as ke}from"../chunks/database.DOikulWS.js";import{a as Ce}from"../chunks/imageUtils.CWp2MXWB.js";import{D as we}from"../chunks/Dialog.Bs59iGLG.js";import{s as V,P as je}from"../chunks/Project.7v5lyGMk.js";function Z(n,e){const s=e.token={};function t(a,o,r,c){if(e.token!==s)return;e.resolved=c;let l=e.ctx;r!==void 0&&(l=l.slice(),l[r]=c);const h=a&&(e.current=a)(l);let f=!1;e.block&&(e.blocks?e.blocks.forEach((C,u)=>{u!==o&&C&&(O(),T(C,1,1,()=>{e.blocks[u]===C&&(e.blocks[u]=null)}),z())}):e.block.d(1),h.c(),q(h,1),h.m(e.mount(),e.anchor),f=!0),e.block=h,e.blocks&&(e.blocks[o]=h),f&&_e()}if(pe(n)){const a=me();if(n.then(o=>{L(a),t(e.then,1,e.value,o),L(null)},o=>{if(L(a),t(e.catch,2,e.error,o),L(null),!e.hasCatch)throw o}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function $e(n,e,s){const t=e.slice(),{resolved:a}=n;n.current===n.then&&(t[n.value]=a),n.current===n.catch&&(t[n.error]=a),n.block.p(t,s)}function ee(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Ue(n,e){T(n,1,1,()=>{e.delete(n.key)})}function xe(n,e,s,t,a,o,r,c,l,h,f,C){let u=n.length,i=o.length,m=u;const p={};for(;m--;)p[n[m].key]=m;const _=[],b=new Map,v=new Map,d=[];for(m=i;m--;){const w=C(a,o,m),M=s(w);let y=r.get(M);y?d.push(()=>y.p(w,e)):(y=h(M,w),y.c()),b.set(M,_[m]=y),M in p&&v.set(M,Math.abs(m-p[M]))}const j=new Set,I=new Set;function W(w){q(w,1),w.m(c,f),r.set(w.key,w),f=w.first,i--}for(;u&&i;){const w=_[i-1],M=n[u-1],y=w.key,S=M.key;w===M?(f=w.first,u--,i--):b.has(S)?!r.has(y)||j.has(y)?W(w):I.has(S)?u--:v.get(y)>v.get(S)?(I.add(y),W(w)):(j.add(S),u--):(l(M,r),u--)}for(;u--;){const w=n[u];b.has(w.key)||l(w,r)}for(;i;)W(_[i-1]);return ne(d),_}function Pe(n){return{c:H,l:H,m:H,p:H,d:H}}function He(n){let e,s;return{c(){e=U("img"),this.h()},l(t){e=x(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Y(e.src,s=n[3].src)||k(e,"src",s),k(e,"alt","Project thumbnail"),k(e,"class","thumbnail svelte-1qp3x4e")},m(t,a){$(t,e,a)},p(t,a){a&8&&!Y(e.src,s=t[3].src)&&k(e,"src",s)},d(t){t&&g(e)}}}function Ie(n){let e,s="Image loading...";return{c(){e=U("p"),e.textContent=s},l(t){e=x(t,"P",{"data-svelte-h":!0}),E(e)!=="svelte-9u03uz"&&(e.textContent=s)},m(t,a){$(t,e,a)},p:H,d(t){t&&g(e)}}}function Me(n){let e,s,t=(n[0].name??"Unnamed Project")+"",a,o,r,c=n[2]?"Are you sure?":"Delete",l,h,f,C="Open",u,i,m="Close",p,_;return{c(){e=U("div"),s=U("h1"),a=G(t),o=A(),r=U("button"),l=G(c),h=A(),f=U("button"),f.textContent=C,u=A(),i=U("button"),i.textContent=m,this.h()},l(b){e=x(b,"DIV",{class:!0});var v=D(e);s=x(v,"H1",{class:!0});var d=D(s);a=K(d,t),d.forEach(g),o=R(v),r=x(v,"BUTTON",{class:!0});var j=D(r);l=K(j,c),j.forEach(g),h=R(v),f=x(v,"BUTTON",{class:!0,"data-svelte-h":!0}),E(f)!=="svelte-1yvfywz"&&(f.textContent=C),u=R(v),i=x(v,"BUTTON",{class:!0,"data-svelte-h":!0}),E(i)!=="svelte-5ltxpq"&&(i.textContent=m),v.forEach(g),this.h()},h(){k(s,"class","svelte-1qp3x4e"),k(r,"class","delete-button svelte-1qp3x4e"),k(f,"class","svelte-1qp3x4e"),k(i,"class","svelte-1qp3x4e"),k(e,"class","dialog svelte-1qp3x4e")},m(b,v){$(b,e,v),P(e,s),P(s,a),P(e,o),P(e,r),P(r,l),P(e,h),P(e,f),P(e,u),P(e,i),p||(_=[N(r,"click",n[4]),N(f,"click",n[5]),N(i,"click",function(){be(n[1].close)&&n[1].close.apply(this,arguments)})],p=!0)},p(b,v){n=b,v&1&&t!==(t=(n[0].name??"Unnamed Project")+"")&&Q(a,t),v&4&&c!==(c=n[2]?"Are you sure?":"Delete")&&Q(l,c)},d(b){b&&g(e),p=!1,ne(_)}}}function ye(n){let e,s,t=(n[0].name??"Unnamed Project")+"",a,o,r,c,l,h,f,C,u,i={ctx:n,current:null,token:null,hasCatch:!1,pending:Ie,then:He,catch:Pe,value:3};Z(r=n[3],i);let m={showDefaultCloseButton:!1,$$slots:{default:[Me]},$$scope:{ctx:n}};return h=new we({props:m}),n[7](h),{c(){e=U("button"),s=U("h3"),a=G(t),o=A(),i.block.c(),l=A(),ie(h.$$.fragment),this.h()},l(p){e=x(p,"BUTTON",{class:!0,"aria-label":!0});var _=D(e);s=x(_,"H3",{class:!0});var b=D(s);a=K(b,t),b.forEach(g),o=R(_),i.block.l(_),_.forEach(g),l=R(p),he(h.$$.fragment,p),this.h()},h(){k(s,"class","svelte-1qp3x4e"),k(e,"class","project exclude-global svelte-1qp3x4e"),k(e,"aria-label",c="Project: "+(n[0].name??"Unnamed Project"))},m(p,_){$(p,e,_),P(e,s),P(s,a),P(e,o),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,$(p,l,_),ue(h,p,_),f=!0,C||(u=N(e,"click",n[6]),C=!0)},p(p,[_]){n=p,(!f||_&1)&&t!==(t=(n[0].name??"Unnamed Project")+"")&&Q(a,t),i.ctx=n,_&8&&r!==(r=n[3])&&Z(r,i)||$e(i,n,_),(!f||_&1&&c!==(c="Project: "+(n[0].name??"Unnamed Project")))&&k(e,"aria-label",c);const b={};_&519&&(b.$$scope={dirty:_,ctx:n}),h.$set(b)},i(p){f||(q(h.$$.fragment,p),f=!0)},o(p){T(h.$$.fragment,p),f=!1},d(p){p&&(g(e),g(l)),i.block.d(),i.token=null,i=null,n[7](null),fe(h,p),C=!1,u()}}}function Ae(n,e,s){let t,a;ae(n,V,u=>s(8,a=u));let{project:o}=e,r,c=!1;async function l(){if(c){r.close(),await de.projects.delete(o.id),a.activeProject===o&&X(V,a.activeProject=null,a);return}s(2,c=!0)}async function h(){X(V,a.activeProject=await je.fromDatabaseProject(o),a),r.close()}const f=()=>{r.open()};function C(u){oe[u?"unshift":"push"](()=>{r=u,s(1,r)})}return n.$$set=u=>{"project"in u&&s(0,o=u.project)},n.$$.update=()=>{n.$$.dirty&1&&s(3,t=o.thumbnail!==null?Ce(o.thumbnail.buffer):new Promise(u=>{const i=new Image;i.onload=()=>{u(i)},i.src=`${F}/no_image.png`}))},[o,r,c,t,l,h,f,C]}class Re extends ce{constructor(e){super(),re(this,e,Ae,ye,le,{project:0})}}class J{constructor(e="",s=!0){this.hash=e,this.autoUpdateWindowHash=s}static fromWindow(e=!0){return new J(window.location.hash.slice(1),e)}updateWindowHash(){return window.location.hash=this.hash===""?"":`#${this.hash}`,this.hash}get(e){return this.getAllHashes()[e]??null}set(e,s){const t=this.getHashString(e,s);return this.contains(e)?this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),`${t},`):(this.hash!==""&&(this.hash+=","),this.hash+=`${t}`),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),this.hash}delete(e){if(!this.contains(e))return null;const s=this.get(e);return this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),",").replace(/,+/,","),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),s}contains(e){return new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`).test(this.hash)}getAllHashes(){const e=this.hash.split(","),s={};for(const t of e){if(t==="")continue;const a=t.split("="),o=decodeURIComponent(a[0]),r=decodeURIComponent(a[1]);s[o]=r}return s}getHashString(e,s){return`${encodeURIComponent(e)}=${encodeURIComponent(s)}`}removeLeadingAndTrailingCommas(){var t,a,o,r;if(!this.hash.startsWith(",")&&!this.hash.endsWith(","))return this.hash;const e=((a=(t=this.hash.match(/^,+/))==null?void 0:t[0])==null?void 0:a.length)??0,s=-(((r=(o=this.hash.match(/,+$/))==null?void 0:o[0])==null?void 0:r.length)??-this.hash.length);return this.hash=this.hash.slice(e,s),this.hash}}function te(n,e,s){const t=n.slice();return t[4]=e[s],t}function Te(n){let e,s="Loading projects...";return{c(){e=U("p"),e.textContent=s},l(t){e=x(t,"P",{"data-svelte-h":!0}),E(e)!=="svelte-sh6bm4"&&(e.textContent=s)},m(t,a){$(t,e,a)},p:H,i:H,o:H,d(t){t&&g(e)}}}function qe(n){let e,s,t,a;const o=[De,Ee],r=[];function c(l,h){return l[1].length>0?0:1}return e=c(n),s=r[e]=o[e](n),{c(){s.c(),t=B()},l(l){s.l(l),t=B()},m(l,h){r[e].m(l,h),$(l,t,h),a=!0},p(l,h){let f=e;e=c(l),e===f?r[e].p(l,h):(O(),T(r[f],1,1,()=>{r[f]=null}),z(),s=r[e],s?s.p(l,h):(s=r[e]=o[e](l),s.c()),q(s,1),s.m(t.parentNode,t))},i(l){a||(q(s),a=!0)},o(l){T(s),a=!1},d(l){l&&g(t),r[e].d(l)}}}function Ee(n){let e,s=`No existing projects! Create a new project with CTRL + K! An actual
          interface is coming Soon™️`;return{c(){e=U("h3"),e.textContent=s,this.h()},l(t){e=x(t,"H3",{class:!0,"data-svelte-h":!0}),E(e)!=="svelte-k2fous"&&(e.textContent=s),this.h()},h(){k(e,"class","svelte-act1aa")},m(t,a){$(t,e,a)},p:H,i:H,o:H,d(t){t&&g(e)}}}function De(n){let e=[],s=new Map,t,a,o=ee(n[1]);const r=c=>c[4].id;for(let c=0;c<o.length;c+=1){let l=te(n,o,c),h=r(l);s.set(h,e[c]=se(h,l))}return{c(){for(let c=0;c<e.length;c+=1)e[c].c();t=B()},l(c){for(let l=0;l<e.length;l+=1)e[l].l(c);t=B()},m(c,l){for(let h=0;h<e.length;h+=1)e[h]&&e[h].m(c,l);$(c,t,l),a=!0},p(c,l){l&2&&(o=ee(c[1]),O(),e=xe(e,l,r,1,c,o,s,t.parentNode,Ue,se,t,te),z())},i(c){if(!a){for(let l=0;l<o.length;l+=1)q(e[l]);a=!0}},o(c){for(let l=0;l<e.length;l+=1)T(e[l]);a=!1},d(c){c&&g(t);for(let l=0;l<e.length;l+=1)e[l].d(c)}}}function se(n,e){let s,t,a;return t=new Re({props:{project:e[4]}}),{key:n,first:null,c(){s=B(),ie(t.$$.fragment),this.h()},l(o){s=B(),he(t.$$.fragment,o),this.h()},h(){this.first=s},m(o,r){$(o,s,r),ue(t,o,r),a=!0},p(o,r){e=o;const c={};r&2&&(c.project=e[4]),t.$set(c)},i(o){a||(q(t.$$.fragment,o),a=!0)},o(o){T(t.$$.fragment,o),a=!1},d(o){o&&g(s),fe(t,o)}}}function We(n){let e,s,t="Melvor Map Maker",a,o,r="",c,l,h,f="Saved Projects",C,u,i,m,p;const _=[qe,Te],b=[];function v(d,j){return d[1]!==void 0?0:1}return i=v(n),m=b[i]=_[i](n),{c(){e=A(),s=U("h1"),s.textContent=t,a=A(),o=U("a"),o.innerHTML=r,c=A(),l=U("div"),h=U("h2"),h.textContent=f,C=A(),u=U("div"),m.c(),this.h()},l(d){ve("svelte-1bq5zbc",document.head).forEach(g),e=R(d),s=x(d,"H1",{class:!0,"data-svelte-h":!0}),E(s)!=="svelte-1w6u9bb"&&(s.textContent=t),a=R(d),o=x(d,"A",{href:!0,class:!0,"data-svelte-h":!0}),E(o)!=="svelte-1vm4tsh"&&(o.innerHTML=r),c=R(d),l=x(d,"DIV",{class:!0});var I=D(l);h=x(I,"H2",{"data-svelte-h":!0}),E(h)!=="svelte-1cctxi5"&&(h.textContent=f),C=R(I),u=x(I,"DIV",{class:!0});var W=D(u);m.l(W),W.forEach(g),I.forEach(g),this.h()},h(){document.title="Melvor Map Maker",k(s,"class","svelte-act1aa"),k(o,"href",F),k(o,"class","svelte-act1aa"),k(u,"class","project-container svelte-act1aa"),k(l,"class","projects svelte-act1aa")},m(d,j){$(d,e,j),$(d,s,j),$(d,a,j),$(d,o,j),n[3](o),$(d,c,j),$(d,l,j),P(l,h),P(l,C),P(l,u),b[i].m(u,null),p=!0},p(d,[j]){let I=i;i=v(d),i===I?b[i].p(d,j):(O(),T(b[I],1,1,()=>{b[I]=null}),z(),m=b[i],m?m.p(d,j):(m=b[i]=_[i](d),m.c()),q(m,1),m.m(u,null))},i(d){p||(q(m),p=!0)},o(d){T(m),p=!1},d(d){d&&(g(e),g(s),g(a),g(o),g(c),g(l)),n[3](null),b[i].d()}}}function Be(n,e,s){let t,a,o=ke(()=>de.projects.toArray());ae(n,o,c=>s(1,t=c)),ge(()=>{const l=J.fromWindow().get("route");l!==null&&(s(0,a.href=`${F}/${l}`,a),a.click())});function r(c){oe[c?"unshift":"push"](()=>{a=c,s(0,a)})}return[a,t,o,r]}class Ke extends ce{constructor(e){super(),re(this,e,Be,We,le,{})}}export{Ke as component};
