import{g as x,B as p}from"./colorToUniform.B4FiDZ1j.js";import{T as C,D as d,n as u}from"./store.C2j4PXn_.js";const v={};function _(n,t){let e=0;for(let a=0;a<t;a++)e=e*31+n[a].uid>>>0;return v[e]||h(n,t,e)}let r=0;function h(n,t,e){const a={};let s=0;r||(r=x());for(let c=0;c<r;c++){const l=c<t?n[c]:C.EMPTY.source;a[s++]=l.source,a[s++]=l.style}const o=new p(a);return v[e]=o,o}class i{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const a=d.get().createCanvas();a.width=t,a.height=e;const s=a.getContext("2d");return{canvas:a,context:s}}getOptimalCanvasAndContext(t,e,a=1){t=Math.ceil(t*a-1e-6),e=Math.ceil(e*a-1e-6),t=u(t),e=u(e);const s=(t<<17)+(e<<1);this._canvasPool[s]||(this._canvasPool[s]=[]);let o=this._canvasPool[s].pop();return o||(o=this._createCanvasAndContext(t,e)),o}returnCanvasAndContext(t){const e=t.canvas,{width:a,height:s}=e,o=(a<<17)+(s<<1);this._canvasPool[o].push(t)}clear(){this._canvasPool={}}}const B=new i;export{B as C,_ as g};
