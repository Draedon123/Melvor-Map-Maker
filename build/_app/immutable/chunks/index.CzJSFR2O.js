import{n as f,s as w,r as m,a as q,i as x}from"./scheduler.DahwKfaf.js";const a=[];function z(t,n){return{subscribe:A(t,n).subscribe}}function A(t,n=f){let e;const s=new Set;function r(n){if(q(t,n)&&(t=n,e)){const n=!a.length;for(const n of s)n[1](),a.push(n,t);if(n){for(let t=0;t<a.length;t+=2)a[t][0](a[t+1]);a.length=0}}}function o(n){r(n(t))}return{set:r,update:o,subscribe:function(a,c=f){const u=[a,c];return s.add(u),1===s.size&&(e=n(r,o)||f),a(t),()=>{s.delete(u),0===s.size&&e&&(e(),e=null)}}}}function E(t,n,e){const s=!Array.isArray(t),r=s?[t]:t;if(!r.every(Boolean))throw Error("derived() expects stores as input, got a falsy value");const o=n.length<2;return z(e,((t,e)=>{let a=0;const c=[];let u=0,i=f;const l=()=>{if(u)return;i();const r=n(s?c[0]:c,t,e);o?t(r):i=x(r)?r:f},d=r.map(((t,n)=>w(t,(t=>{c[n]=t,u&=~(1<<n),a&&l()}),(()=>{u|=1<<n}))));return a=1,l(),function(){m(d),i(),a=0}}))}export{E as d,A as w};