import{A as ue,B as he,w as y,l as fe,a as ee,j as te,C as K,d as se,n as P,e as Q,i as de,r as pe,o as _e}from"../chunks/scheduler.DkrlBnXb.js";import{y as W,t as T,v as B,a as q,S as ne,i as le,e as w,o as N,s as H,c as ae,b as $,d as M,p as O,h as _,g as I,f as oe,j as v,k as j,l as U,m as re,r as D,x as S,n as ce,q as R,A as me,u as E}from"../chunks/index.CJkGS9EB.js";import{e as F,u as be,o as ve}from"../chunks/each.CjMBh5kj.js";import{b as z}from"../chunks/paths.BLSsAkTL.js";import{d as ie,l as ge}from"../chunks/database.DCq9Aijm.js";import{f as ke}from"../chunks/imageUtils.CAsRoNnr.js";import{D as Ce}from"../chunks/Dialog.CMVM9_Tx.js";import{s as L,P as J}from"../chunks/store.CtDx7cld.js";function X(l,e){const s=e.token={};function t(a,o,c,r){if(e.token!==s)return;e.resolved=r;let n=e.ctx;c!==void 0&&(n=n.slice(),n[c]=r);const i=a&&(e.current=a)(n);let f=!1;e.block&&(e.blocks?e.blocks.forEach((k,h)=>{h!==o&&k&&(W(),T(k,1,1,()=>{e.blocks[h]===k&&(e.blocks[h]=null)}),B())}):e.block.d(1),i.c(),q(i,1),i.m(e.mount(),e.anchor),f=!0),e.block=i,e.blocks&&(e.blocks[o]=i),f&&fe()}if(ue(l)){const a=he();if(l.then(o=>{y(a),t(e.then,1,e.value,o),y(null)},o=>{if(y(a),t(e.catch,2,e.error,o),y(null),!e.hasCatch)throw o}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,l),!0;e.resolved=l}}function je(l,e,s){const t=e.slice(),{resolved:a}=l;l.current===l.then&&(t[l.value]=a),l.current===l.catch&&(t[l.error]=a),l.block.p(t,s)}function we(l){return{c:P,l:P,m:P,p:P,d:P}}function $e(l){let e,s;return{c(){e=w("img"),this.h()},l(t){e=$(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Q(e.src,s=l[3].src)||v(e,"src",s),v(e,"alt","Project thumbnail"),v(e,"class","thumbnail svelte-1qp3x4e")},m(t,a){j(t,e,a)},p(t,a){a&8&&!Q(e.src,s=t[3].src)&&v(e,"src",s)},d(t){t&&_(e)}}}function Ue(l){let e,s="Image loading...";return{c(){e=w("p"),e.textContent=s},l(t){e=$(t,"P",{"data-svelte-h":!0}),R(e)!=="svelte-9u03uz"&&(e.textContent=s)},m(t,a){j(t,e,a)},p:P,d(t){t&&_(e)}}}function xe(l){let e,s,t=(l[0].name??"Unnamed Project")+"",a,o,c,r=l[2]?"Are you sure?":"Delete",n,i,f,k="Open",h,u,g="Close",p,b;return{c(){e=w("div"),s=w("h1"),a=N(t),o=H(),c=w("button"),n=N(r),i=H(),f=w("button"),f.textContent=k,h=H(),u=w("button"),u.textContent=g,this.h()},l(m){e=$(m,"DIV",{class:!0});var C=M(e);s=$(C,"H1",{class:!0});var d=M(s);a=O(d,t),d.forEach(_),o=I(C),c=$(C,"BUTTON",{class:!0});var x=M(c);n=O(x,r),x.forEach(_),i=I(C),f=$(C,"BUTTON",{class:!0,"data-svelte-h":!0}),R(f)!=="svelte-1yvfywz"&&(f.textContent=k),h=I(C),u=$(C,"BUTTON",{class:!0,"data-svelte-h":!0}),R(u)!=="svelte-5ltxpq"&&(u.textContent=g),C.forEach(_),this.h()},h(){v(s,"class","svelte-1qp3x4e"),v(c,"class","delete-button svelte-1qp3x4e"),v(f,"class","svelte-1qp3x4e"),v(u,"class","svelte-1qp3x4e"),v(e,"class","dialog svelte-1qp3x4e")},m(m,C){j(m,e,C),U(e,s),U(s,a),U(e,o),U(e,c),U(c,n),U(e,i),U(e,f),U(e,h),U(e,u),p||(b=[D(c,"click",l[4]),D(f,"click",l[5]),D(u,"click",function(){de(l[1].close)&&l[1].close.apply(this,arguments)})],p=!0)},p(m,C){l=m,C&1&&t!==(t=(l[0].name??"Unnamed Project")+"")&&S(a,t),C&4&&r!==(r=l[2]?"Are you sure?":"Delete")&&S(n,r)},d(m){m&&_(e),p=!1,pe(b)}}}function Pe(l){let e,s,t=(l[0].name??"Unnamed Project")+"",a,o,c,r,n,i,f,k,h,u={ctx:l,current:null,token:null,hasCatch:!1,pending:Ue,then:$e,catch:we,value:3};X(c=l[3],u);let g={showDefaultCloseButton:!1,$$slots:{default:[xe]},$$scope:{ctx:l}};return i=new Ce({props:g}),l[7](i),{c(){e=w("button"),s=w("h3"),a=N(t),o=H(),u.block.c(),n=H(),ae(i.$$.fragment),this.h()},l(p){e=$(p,"BUTTON",{class:!0,"aria-label":!0});var b=M(e);s=$(b,"H3",{class:!0});var m=M(s);a=O(m,t),m.forEach(_),o=I(b),u.block.l(b),b.forEach(_),n=I(p),oe(i.$$.fragment,p),this.h()},h(){v(s,"class","svelte-1qp3x4e"),v(e,"class","project exclude-global svelte-1qp3x4e"),v(e,"aria-label",r="Project: "+(l[0].name??"Unnamed Project"))},m(p,b){j(p,e,b),U(e,s),U(s,a),U(e,o),u.block.m(e,u.anchor=null),u.mount=()=>e,u.anchor=null,j(p,n,b),re(i,p,b),f=!0,k||(h=D(e,"click",l[6]),k=!0)},p(p,[b]){l=p,(!f||b&1)&&t!==(t=(l[0].name??"Unnamed Project")+"")&&S(a,t),u.ctx=l,b&8&&c!==(c=l[3])&&X(c,u)||je(u,l,b),(!f||b&1&&r!==(r="Project: "+(l[0].name??"Unnamed Project")))&&v(e,"aria-label",r);const m={};b&519&&(m.$$scope={dirty:b,ctx:l}),i.$set(m)},i(p){f||(q(i.$$.fragment,p),f=!0)},o(p){T(i.$$.fragment,p),f=!1},d(p){p&&(_(e),_(n)),u.block.d(),u.token=null,u=null,l[7](null),ce(i,p),k=!1,h()}}}function He(l,e,s){let t,a;te(l,L,h=>s(8,a=h));let{project:o}=e,c,r=!1;async function n(){if(r){c.close(),await ie.projects.delete(o.id),a.activeProject===o&&K(L,a.activeProject=new J,a);return}s(2,r=!0)}async function i(){K(L,a.activeProject=await J.fromDatabaseProject(o),a),c.close()}const f=()=>{c.open()};function k(h){se[h?"unshift":"push"](()=>{c=h,s(1,c)})}return l.$$set=h=>{"project"in h&&s(0,o=h.project)},l.$$.update=()=>{l.$$.dirty&1&&s(3,t=o.thumbnail!==null?ke(o.thumbnail.buffer):new Promise(h=>{const u=new Image;u.onload=()=>{h(u)},u.src=`${z}/no_image.png`}))},[o,c,r,t,n,i,f,k]}class Ie extends ne{constructor(e){super(),le(this,e,He,Pe,ee,{project:0})}}class V{constructor(e="",s=!0){this.hash=e,this.autoUpdateWindowHash=s}static fromWindow(e=!0){return new V(window.location.hash.slice(1),e)}updateWindowHash(){return window.location.hash=this.hash===""?"":`#${this.hash}`,this.hash}get(e){return this.getAllHashes()[e]??null}set(e,s){const t=this.getHashString(e,s);return this.contains(e)?this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),`${t},`):(this.hash!==""&&(this.hash+=","),this.hash+=`${t}`),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),this.hash}delete(e){if(!this.contains(e))return null;const s=this.get(e);return this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),",").replace(/,+/,","),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),s}contains(e){return new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`).test(this.hash)}getAllHashes(){const e=this.hash.split(","),s={};for(const t of e){if(t==="")continue;const a=t.split("="),o=decodeURIComponent(a[0]),c=decodeURIComponent(a[1]);s[o]=c}return s}getHashString(e,s){return`${encodeURIComponent(e)}=${encodeURIComponent(s)}`}removeLeadingAndTrailingCommas(){var t,a,o,c;if(!this.hash.startsWith(",")&&!this.hash.endsWith(","))return this.hash;const e=((a=(t=this.hash.match(/^,+/))==null?void 0:t[0])==null?void 0:a.length)??0,s=-(((c=(o=this.hash.match(/,+$/))==null?void 0:o[0])==null?void 0:c.length)??-this.hash.length);return this.hash=this.hash.slice(e,s),this.hash}}function Y(l,e,s){const t=l.slice();return t[4]=e[s],t}function Ae(l){let e,s="Loading projects...";return{c(){e=w("p"),e.textContent=s},l(t){e=$(t,"P",{"data-svelte-h":!0}),R(e)!=="svelte-sh6bm4"&&(e.textContent=s)},m(t,a){j(t,e,a)},p:P,i:P,o:P,d(t){t&&_(e)}}}function Re(l){let e,s,t,a;const o=[qe,Te],c=[];function r(n,i){return n[1].length>0?0:1}return e=r(l),s=c[e]=o[e](l),{c(){s.c(),t=E()},l(n){s.l(n),t=E()},m(n,i){c[e].m(n,i),j(n,t,i),a=!0},p(n,i){let f=e;e=r(n),e===f?c[e].p(n,i):(W(),T(c[f],1,1,()=>{c[f]=null}),B(),s=c[e],s?s.p(n,i):(s=c[e]=o[e](n),s.c()),q(s,1),s.m(t.parentNode,t))},i(n){a||(q(s),a=!0)},o(n){T(s),a=!1},d(n){n&&_(t),c[e].d(n)}}}function Te(l){let e,s=`No existing projects! Create a new project with CTRL + K! An actual
          interface is coming Soon™️`;return{c(){e=w("h3"),e.textContent=s,this.h()},l(t){e=$(t,"H3",{class:!0,"data-svelte-h":!0}),R(e)!=="svelte-k2fous"&&(e.textContent=s),this.h()},h(){v(e,"class","svelte-act1aa")},m(t,a){j(t,e,a)},p:P,i:P,o:P,d(t){t&&_(e)}}}function qe(l){let e=[],s=new Map,t,a,o=F(l[1]);const c=r=>r[4].id;for(let r=0;r<o.length;r+=1){let n=Y(l,o,r),i=c(n);s.set(i,e[r]=Z(i,n))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();t=E()},l(r){for(let n=0;n<e.length;n+=1)e[n].l(r);t=E()},m(r,n){for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(r,n);j(r,t,n),a=!0},p(r,n){n&2&&(o=F(r[1]),W(),e=be(e,n,c,1,r,o,s,t.parentNode,ve,Z,t,Y),B())},i(r){if(!a){for(let n=0;n<o.length;n+=1)q(e[n]);a=!0}},o(r){for(let n=0;n<e.length;n+=1)T(e[n]);a=!1},d(r){r&&_(t);for(let n=0;n<e.length;n+=1)e[n].d(r)}}}function Z(l,e){let s,t,a;return t=new Ie({props:{project:e[4]}}),{key:l,first:null,c(){s=E(),ae(t.$$.fragment),this.h()},l(o){s=E(),oe(t.$$.fragment,o),this.h()},h(){this.first=s},m(o,c){j(o,s,c),re(t,o,c),a=!0},p(o,c){e=o;const r={};c&2&&(r.project=e[4]),t.$set(r)},i(o){a||(q(t.$$.fragment,o),a=!0)},o(o){T(t.$$.fragment,o),a=!1},d(o){o&&_(s),ce(t,o)}}}function Me(l){let e,s,t="Melvor Map Maker",a,o,c="",r,n,i,f="Saved Projects",k,h,u,g,p;const b=[Re,Ae],m=[];function C(d,x){return d[1]!==void 0?0:1}return u=C(l),g=m[u]=b[u](l),{c(){e=H(),s=w("h1"),s.textContent=t,a=H(),o=w("a"),o.innerHTML=c,r=H(),n=w("div"),i=w("h2"),i.textContent=f,k=H(),h=w("div"),g.c(),this.h()},l(d){me("svelte-1bq5zbc",document.head).forEach(_),e=I(d),s=$(d,"H1",{class:!0,"data-svelte-h":!0}),R(s)!=="svelte-1w6u9bb"&&(s.textContent=t),a=I(d),o=$(d,"A",{href:!0,class:!0,"data-svelte-h":!0}),R(o)!=="svelte-1vm4tsh"&&(o.innerHTML=c),r=I(d),n=$(d,"DIV",{class:!0});var A=M(n);i=$(A,"H2",{"data-svelte-h":!0}),R(i)!=="svelte-1cctxi5"&&(i.textContent=f),k=I(A),h=$(A,"DIV",{class:!0});var G=M(h);g.l(G),G.forEach(_),A.forEach(_),this.h()},h(){document.title="Melvor Map Maker",v(s,"class","svelte-act1aa"),v(o,"href",z),v(o,"class","svelte-act1aa"),v(h,"class","project-container svelte-act1aa"),v(n,"class","projects svelte-act1aa")},m(d,x){j(d,e,x),j(d,s,x),j(d,a,x),j(d,o,x),l[3](o),j(d,r,x),j(d,n,x),U(n,i),U(n,k),U(n,h),m[u].m(h,null),p=!0},p(d,[x]){let A=u;u=C(d),u===A?m[u].p(d,x):(W(),T(m[A],1,1,()=>{m[A]=null}),B(),g=m[u],g?g.p(d,x):(g=m[u]=b[u](d),g.c()),q(g,1),g.m(h,null))},i(d){p||(q(g),p=!0)},o(d){T(g),p=!1},d(d){d&&(_(e),_(s),_(a),_(o),_(r),_(n)),l[3](null),m[u].d()}}}function Ee(l,e,s){let t,a,o=ge(()=>ie.projects.toArray());te(l,o,r=>s(1,t=r)),_e(()=>{const n=V.fromWindow().get("route");n!==null&&(s(0,a.href=`${z}/${n}`,a),a.click())});function c(r){se[r?"unshift":"push"](()=>{a=r,s(0,a)})}return[a,t,o,c]}class ze extends ne{constructor(e){super(),le(this,e,Ee,Me,ee,{})}}export{ze as component};
