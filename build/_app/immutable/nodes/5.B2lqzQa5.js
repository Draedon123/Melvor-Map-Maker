import{a as fe,c as Ye,u as Xe,g as We,b as xe,d as O,j as _e,C as Be,r as ye,F as he,o as Ke,G as Je}from"../chunks/scheduler.DkrlBnXb.js";import{S as ce,i as ge,e as B,b as y,d as C,h as w,j as h,B as ie,k as G,a as q,t as Y,c as J,f as Q,m as $,n as ee,s as R,q as oe,g as A,u as Ne,o as X,p as W,l as b,D as me,r as ne,E as ve,F as be,x as Se,A as Qe,C as we}from"../chunks/index.CJkGS9EB.js";import"../chunks/database.DCq9Aijm.js";import{b as $e}from"../chunks/paths.BLSsAkTL.js";import{s as re,m as Le}from"../chunks/store.zhrxRWFP.js";import{r as Ve,s as ze,b as Ce,t as et}from"../chunks/imageUtils.CAsRoNnr.js";import{D as tt,P as nt}from"../chunks/DragDropUpload.BWgC5XB8.js";function st(e,t,n){return Math.max(Math.min(e,n),t)}function it(e){let t,n;const s=e[5].default,i=Ye(s,e,e[4],null);return{c(){t=B("div"),i&&i.c(),this.h()},l(a){t=y(a,"DIV",{"data-form-stage":!0,class:!0});var r=C(t);i&&i.l(r),r.forEach(w),this.h()},h(){h(t,"data-form-stage",""),h(t,"class","svelte-1jweudo"),ie(t,"hidden",e[1])},m(a,r){G(a,t,r),i&&i.m(t,null),e[6](t),n=!0},p(a,[r]){i&&i.p&&(!n||r&16)&&Xe(i,s,a,a[4],n?xe(s,a[4],r,null):We(a[4]),null),(!n||r&2)&&ie(t,"hidden",a[1])},i(a){n||(q(i,a),n=!0)},o(a){Y(i,a),n=!1},d(a){a&&w(t),i&&i.d(a),e[6](null)}}}function at(e,t,n){let s,{$$slots:i={},$$scope:a}=t,{stage:r}=t,{currentStage:l}=t,u;function c(g){O[g?"unshift":"push"](()=>{u=g,n(0,u)})}return e.$$set=g=>{"stage"in g&&n(2,r=g.stage),"currentStage"in g&&n(3,l=g.currentStage),"$$scope"in g&&n(4,a=g.$$scope)},e.$$.update=()=>{e.$$.dirty&12&&n(1,s=r!==l)},[u,s,r,l,a,i,c]}class Ie extends ce{constructor(t){super(),ge(this,t,at,it,fe,{stage:2,currentStage:3})}}function Re(e){let t,n=`To preview your uploaded image, click the
          <img src="${$e}/preview.png" alt="A document and a magnifying glass" style="height: 2em; width: 2em; display: inline; margin-left: 0.7ch; position: relative; top: 0.5em;"/>
          icon on the left toolbar`;return{c(){t=B("p"),t.innerHTML=n},l(s){t=y(s,"P",{"data-svelte-h":!0}),oe(t)!=="svelte-10meixp"&&(t.innerHTML=n)},m(s,i){G(s,t,i)},d(s){s&&w(t)}}}function rt(e){let t,n="Drag and drop a .png image here, or click to upload a file.",s,i,a=e[1].mapImage!==null&&Re();return{c(){t=B("p"),t.textContent=n,s=R(),a&&a.c(),i=Ne()},l(r){t=y(r,"P",{"data-svelte-h":!0}),oe(t)!=="svelte-1rb6i9x"&&(t.textContent=n),s=A(r),a&&a.l(r),i=Ne()},m(r,l){G(r,t,l),G(r,s,l),a&&a.m(r,l),G(r,i,l)},p(r,l){r[1].mapImage!==null?a||(a=Re(),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null)},d(r){r&&(w(t),w(s),w(i)),a&&a.d(r)}}}function ot(e){let t,n="Step 1: Insert Your Map Image",s,i,a,r;return a=new tt({props:{onFileUpload:e[6],validFileRegex:/.+\.png$/,mimeType:"image/png",$$slots:{default:[rt]},$$scope:{ctx:e}}}),{c(){t=B("h1"),t.textContent=n,s=R(),i=B("div"),J(a.$$.fragment),this.h()},l(l){t=y(l,"H1",{class:!0,"data-svelte-h":!0}),oe(t)!=="svelte-g4n8qo"&&(t.textContent=n),s=A(l),i=y(l,"DIV",{class:!0});var u=C(i);Q(a.$$.fragment,u),u.forEach(w),this.h()},h(){h(t,"class","svelte-1g4c4fn"),h(i,"class","file-upload-container svelte-1g4c4fn")},m(l,u){G(l,t,u),G(l,s,u),G(l,i,u),$(a,i,null),r=!0},p(l,u){const c={};u&258&&(c.$$scope={dirty:u,ctx:l}),a.$set(c)},i(l){r||(q(a.$$.fragment,l),r=!0)},o(l){Y(a.$$.fragment,l),r=!1},d(l){l&&(w(t),w(s),w(i)),ee(a)}}}function lt(e){let t,n;return t=new Ie({props:{stage:1,currentStage:e[0],$$slots:{default:[ot]},$$scope:{ctx:e}}}),{c(){J(t.$$.fragment)},l(s){Q(t.$$.fragment,s)},m(s,i){$(t,s,i),n=!0},p(s,[i]){const a={};i&1&&(a.currentStage=s[0]),i&258&&(a.$$scope={dirty:i,ctx:s}),t.$set(a)},i(s){n||(q(t.$$.fragment,s),n=!0)},o(s){Y(t.$$.fragment,s),n=!1},d(s){ee(t,s)}}}const ut="StageOne";function ft(e,t,n){let s;_e(e,re,o=>n(1,s=o));let{activeStage:i}=t,{canGoToNextStage:a}=t,{disableAdvanceStageButtons:r}=t;function l(){return u===null?"No uploaded image":!0}let u=null;function c(o){const F=new Blob([o]),d=URL.createObjectURL(F);n(4,r=!0);const f=new Image;f.onload=()=>{const Z=f.width%8,m=f.height%8;Ve(f,{type:"additive",x:Z,y:m}).then(p=>{u=p,s.mapImage!==null&&URL.revokeObjectURL(s.mapImage.src),Be(re,s.mapImage=p,s),n(4,r=!1),n(3,a=l())}).catch(p=>{n(4,r=!1);const D=p instanceof Error?p.message:"Unspecified error";return p(`${ut} | uploadMapImage`,D)})},f.src=d}const g=o=>{c(o[0])};return e.$$set=o=>{"activeStage"in o&&n(0,i=o.activeStage),"canGoToNextStage"in o&&n(3,a=o.canGoToNextStage),"disableAdvanceStageButtons"in o&&n(4,r=o.disableAdvanceStageButtons)},[i,s,c,a,r,l,g]}class ct extends ce{constructor(t){super(),ge(this,t,ft,lt,fe,{activeStage:0,canGoToNextStage:3,disableAdvanceStageButtons:4,isStageComplete:5})}get isStageComplete(){return this.$$.ctx[5]}}function gt(e){let t,n,s="Step 2: (Optional)",i,a,r,l,u,c,g,o,F,d,f,Z;return{c(){t=B("div"),n=B("h1"),n.textContent=s,i=R(),a=B("label"),r=X(`Tile Width:
      `),l=B("input"),u=R(),c=B("br"),g=R(),o=B("label"),F=X(`Tile Height:
      `),d=B("input"),this.h()},l(m){t=y(m,"DIV",{class:!0});var p=C(t);n=y(p,"H1",{class:!0,"data-svelte-h":!0}),oe(n)!=="svelte-szwyjl"&&(n.textContent=s),i=A(p),a=y(p,"LABEL",{for:!0,class:!0});var D=C(a);r=W(D,`Tile Width:
      `),l=y(D,"INPUT",{id:!0,name:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),D.forEach(w),u=A(p),c=y(p,"BR",{}),g=A(p),o=y(p,"LABEL",{for:!0,class:!0});var j=C(o);F=W(j,`Tile Height:
      `),d=y(j,"INPUT",{id:!0,name:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),j.forEach(w),p.forEach(w),this.h()},h(){h(n,"class","svelte-10cjdqg"),h(l,"id","tileWidth"),h(l,"name","tileWidth"),h(l,"type","number"),h(l,"min","1"),h(l,"max","2000"),h(l,"step","1"),h(l,"class","svelte-10cjdqg"),ie(l,"invalid",typeof e[3]=="string"),h(a,"for","tileWidth"),h(a,"class","svelte-10cjdqg"),h(d,"id","tileHeight"),h(d,"name","tileHeight"),h(d,"type","number"),h(d,"min","1"),h(d,"max","2000"),h(d,"step","1"),h(d,"class","svelte-10cjdqg"),ie(d,"invalid",typeof e[3]=="string"),h(o,"for","tileHeight"),h(o,"class","svelte-10cjdqg"),h(t,"class","container svelte-10cjdqg")},m(m,p){G(m,t,p),b(t,n),b(t,i),b(t,a),b(a,r),b(a,l),me(l,e[1]),b(t,u),b(t,c),b(t,g),b(t,o),b(o,F),b(o,d),me(d,e[2]),f||(Z=[ne(l,"input",e[7]),ne(d,"input",e[8])],f=!0)},p(m,p){p&2&&ve(l.value)!==m[1]&&me(l,m[1]),p&8&&ie(l,"invalid",typeof m[3]=="string"),p&4&&ve(d.value)!==m[2]&&me(d,m[2]),p&8&&ie(d,"invalid",typeof m[3]=="string")},d(m){m&&w(t),f=!1,ye(Z)}}}function dt(e){let t,n;return t=new Ie({props:{stage:2,currentStage:e[0],$$slots:{default:[gt]},$$scope:{ctx:e}}}),{c(){J(t.$$.fragment)},l(s){Q(t.$$.fragment,s)},m(s,i){$(t,s,i),n=!0},p(s,[i]){const a={};i&1&&(a.currentStage=s[0]),i&2062&&(a.$$scope={dirty:i,ctx:s}),t.$set(a)},i(s){n||(q(t.$$.fragment,s),n=!0)},o(s){Y(t.$$.fragment,s),n=!1},d(s){ee(t,s)}}}function Ae(e,t,n){if(t<1)return"Tile width must be greater than 1";if(n<1)return"Tile height must be greater than 1";if(!Number.isInteger(t))return"Tile width must be an integer";if(!Number.isInteger(n))return"Tile height must be an integer";if(t>2e3)return"Tile width must be less than 2000";if(n>2e3)return"Tile height must be less than 2000";if(e!==null){if(!Number.isInteger(e.width/t))return"Tile width does not produce an integer number of tiles";if(!Number.isInteger(e.height/n))return"Tile height does not produce an integer number of tiles"}return!0}function De(e){for(let t=1;t++;t<e){const n=e/t;if(Number.isInteger(n)&&n<2e3)return n}return 0}function mt(e,t,n){let s,i,a;_e(e,Le,f=>n(6,i=f)),_e(e,re,f=>n(10,a=f));let{activeStage:r}=t,{canGoToNextStage:l}=t;function u(){return Ae(i,c,g)}let c=1,g=1,o=null;Le.subscribe(f=>{o!==f&&(o=f,n(1,c=f===null?1:De(f.width)),n(2,g=f===null?1:De(f.height)))});function F(){c=ve(this.value),n(1,c)}function d(){g=ve(this.value),n(2,g)}return e.$$set=f=>{"activeStage"in f&&n(0,r=f.activeStage),"canGoToNextStage"in f&&n(4,l=f.canGoToNextStage)},e.$$.update=()=>{if(e.$$.dirty&66){const f=((i==null?void 0:i.width)??0)/c;Number.isInteger(f)&&Be(re,a.tilesX=f,a)}if(e.$$.dirty&68){const f=((i==null?void 0:i.height)??0)/g;Number.isInteger(f)&&Be(re,a.tilesY=f,a)}e.$$.dirty&70&&n(3,s=(()=>{const f=Ae(i,c,g);return n(4,l=f),f})())},[r,c,g,s,l,u,i,F,d]}class pt extends ce{constructor(t){super(),ge(this,t,mt,dt,fe,{activeStage:0,canGoToNextStage:4,isStageComplete:5})}get isStageComplete(){return this.$$.ctx[5]}}"stream"in Blob.prototype||Object.defineProperty(Blob.prototype,"stream",{value(){return new Response(this).body}}),"setBigUint64"in DataView.prototype||Object.defineProperty(DataView.prototype,"setBigUint64",{value(e,t,n){const s=Number(0xffffffffn&t),i=Number(t>>32n);this.setUint32(e+(n?0:4),s,n),this.setUint32(e+(n?4:0),i,n)}});var le=e=>new DataView(new ArrayBuffer(e)),x=e=>new Uint8Array(e.buffer||e),ae=e=>new TextEncoder().encode(String(e)),se=e=>Math.min(4294967295,Number(e)),ke=e=>Math.min(65535,Number(e));function ht(e,t){if(t===void 0||t instanceof Date||(t=new Date(t)),e instanceof File)return{isFile:1,t:t||new Date(e.lastModified),i:e.stream()};if(e instanceof Response)return{isFile:1,t:t||new Date(e.headers.get("Last-Modified")||Date.now()),i:e.body};if(t===void 0)t=new Date;else if(isNaN(t))throw new Error("Invalid modification date.");if(e===void 0)return{isFile:0,t};if(typeof e=="string")return{isFile:1,t,i:ae(e)};if(e instanceof Blob)return{isFile:1,t,i:e.stream()};if(e instanceof Uint8Array||e instanceof ReadableStream)return{isFile:1,t,i:e};if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))return{isFile:1,t,i:x(e)};if(Symbol.asyncIterator in e)return{isFile:1,t,i:Ge(e[Symbol.asyncIterator]())};throw new TypeError("Unsupported input format.")}function Ge(e,t=e){return new ReadableStream({async pull(n){let s=0;for(;n.desiredSize>s;){const i=await e.next();if(!i.value){n.close();break}{const a=bt(i.value);n.enqueue(a),s+=a.byteLength}}},cancel(n){var s;(s=t.throw)==null||s.call(t,n)}})}function bt(e){return typeof e=="string"?ae(e):e instanceof Uint8Array?e:x(e)}function He(e,t,n){let[s,i]=function(a){return a?a instanceof Uint8Array?[a,1]:ArrayBuffer.isView(a)||a instanceof ArrayBuffer?[x(a),1]:[ae(a),0]:[void 0,0]}(t);if(e instanceof File)return{o:Ue(s||ae(e.name)),u:BigInt(e.size),l:i};if(e instanceof Response){const a=e.headers.get("content-disposition"),r=a&&a.match(/;\s*filename\*?=["']?(.*?)["']?$/i),l=r&&r[1]||e.url&&new URL(e.url).pathname.split("/").findLast(Boolean),u=l&&decodeURIComponent(l),c=n||+e.headers.get("content-length");return{o:Ue(s||ae(u)),u:BigInt(c),l:i}}return s=Ue(s,e!==void 0||n!==void 0),typeof e=="string"?{o:s,u:BigInt(ae(e).length),l:i}:e instanceof Blob?{o:s,u:BigInt(e.size),l:i}:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?{o:s,u:BigInt(e.byteLength),l:i}:{o:s,u:_t(e,n),l:i}}function _t(e,t){return t>-1?BigInt(t):e?void 0:0n}function Ue(e,t=1){if(!e||e.every(n=>n===47))throw new Error("The file must have a name.");if(t)for(;e[e.length-1]===47;)e=e.subarray(0,-1);else e[e.length-1]!==47&&(e=new Uint8Array([...e,47]));return e}var Me=new Uint32Array(256);for(let e=0;e<256;++e){let t=e;for(let n=0;n<8;++n)t=t>>>1^(1&t&&3988292384);Me[e]=t}function Ze(e,t=0){t^=-1;for(var n=0,s=e.length;n<s;n++)t=t>>>8^Me[255&t^e[n]];return(-1^t)>>>0}function Oe(e,t,n=0){const s=e.getSeconds()>>1|e.getMinutes()<<5|e.getHours()<<11,i=e.getDate()|e.getMonth()+1<<5|e.getFullYear()-1980<<9;t.setUint16(n,s,1),t.setUint16(n+2,i,1)}function vt({o:e,l:t},n){return 8*(!t||(n??function(s){try{St.decode(s)}catch{return 0}return 1}(e)))}var St=new TextDecoder("utf8",{fatal:1});function wt(e,t=0){const n=le(30);return n.setUint32(0,1347093252),n.setUint32(4,754976768|t),Oe(e.t,n,10),n.setUint16(26,e.o.length,1),x(n)}async function*Ut(e){let{i:t}=e;if("then"in t&&(t=await t),t instanceof Uint8Array)yield t,e.m=Ze(t,0),e.u=BigInt(t.length);else{e.u=0n;const n=t.getReader();for(;;){const{value:s,done:i}=await n.read();if(i)break;e.m=Ze(s,e.m),e.u+=BigInt(s.length),yield s}}}function Bt(e,t){const n=le(16+(t?8:0));return n.setUint32(0,1347094280),n.setUint32(4,e.isFile?e.m:0,1),t?(n.setBigUint64(8,e.u,1),n.setBigUint64(16,e.u,1)):(n.setUint32(8,se(e.u),1),n.setUint32(12,se(e.u),1)),x(n)}function yt(e,t,n=0,s=0){const i=le(46);return i.setUint32(0,1347092738),i.setUint32(4,755182848),i.setUint16(8,2048|n),Oe(e.t,i,12),i.setUint32(16,e.isFile?e.m:0,1),i.setUint32(20,se(e.u),1),i.setUint32(24,se(e.u),1),i.setUint16(28,e.o.length,1),i.setUint16(30,s,1),i.setUint16(40,e.isFile?33204:16893,1),i.setUint32(42,se(t),1),x(i)}function It(e,t,n){const s=le(n);return s.setUint16(0,1,1),s.setUint16(2,n-4,1),16&n&&(s.setBigUint64(4,e.u,1),s.setBigUint64(12,e.u,1)),s.setBigUint64(n-8,t,1),x(s)}function qe(e){return e instanceof File||e instanceof Response?[[e],[e]]:[[e.input,e.name,e.size],[e.input,e.lastModified]]}var Tt=e=>function(t){let n=BigInt(22),s=0n,i=0;for(const a of t){if(!a.o)throw new Error("Every file must have a non-empty name.");if(a.u===void 0)throw new Error(`Missing size for file "${new TextDecoder().decode(a.o)}".`);const r=a.u>=0xffffffffn,l=s>=0xffffffffn;s+=BigInt(46+a.o.length+(r&&8))+a.u,n+=BigInt(a.o.length+46+(12*l|28*r)),i||(i=r)}return(i||s>=0xffffffffn)&&(n+=BigInt(76)),n+s}(function*(t){for(const n of t)yield He(...qe(n)[0])}(e));function pe(e,t={}){const n={"Content-Type":"application/zip","Content-Disposition":"attachment"};return(typeof t.length=="bigint"||Number.isInteger(t.length))&&t.length>0&&(n["Content-Length"]=String(t.length)),t.metadata&&(n["Content-Length"]=String(Tt(t.metadata))),new Response(Ft(e,t),{headers:n})}function Ft(e,t={}){const n=function(s){var a;const i=s[Symbol.iterator in s?Symbol.iterator:Symbol.asyncIterator]();return{async next(){const r=await i.next();if(r.done)return r;const[l,u]=qe(r.value);return{done:0,value:Object.assign(ht(...u),He(...l))}},throw:(a=i.throw)==null?void 0:a.bind(i),[Symbol.asyncIterator](){return this}}}(e);return Ge(async function*(s,i){const a=[];let r=0n,l=0n,u=0;for await(const o of s){const F=vt(o,i.buffersAreUTF8);yield wt(o,F),yield new Uint8Array(o.o),o.isFile&&(yield*Ut(o));const d=o.u>=0xffffffffn,f=12*(r>=0xffffffffn)|28*d;yield Bt(o,d),a.push(yt(o,r,F,f)),a.push(o.o),f&&a.push(It(o,r,f)),d&&(r+=8n),l++,r+=BigInt(46+o.o.length)+o.u,u||(u=d)}let c=0n;for(const o of a)yield o,c+=BigInt(o.length);if(u||r>=0xffffffffn){const o=le(76);o.setUint32(0,1347094022),o.setBigUint64(4,BigInt(44),1),o.setUint32(12,755182848),o.setBigUint64(24,l,1),o.setBigUint64(32,l,1),o.setBigUint64(40,c,1),o.setBigUint64(48,r,1),o.setUint32(56,1347094023),o.setBigUint64(64,r+c,1),o.setUint32(72,1,1),yield x(o)}const g=le(22);g.setUint32(0,1347093766),g.setUint16(8,ke(l),1),g.setUint16(10,ke(l),1),g.setUint32(12,se(c),1),g.setUint32(16,se(r),1),yield x(g)}(n,t),n)}function je(e){let t,n;return{c(){t=B("span"),n=X(e[3]),this.h()},l(s){t=y(s,"SPAN",{class:!0});var i=C(t);n=W(i,e[3]),i.forEach(w),this.h()},h(){h(t,"class","error svelte-1vaxzue")},m(s,i){G(s,t,i),b(t,n)},p(s,i){i&8&&Se(n,s[3])},d(s){s&&w(t)}}}function Et(e){let t,n,s="Step 3: Convert and Download Files",i,a,r,l,u,c,g,o,F,d,f,Z,m,p,D="Convert",j,k,L,U,P,N,V,K;function ue(v){e[10](v)}let I={ariaLabel:"File Conversion Progress"};e[1]!==void 0&&(I.value=e[1]),d=new nt({props:I}),e[9](d),O.push(()=>be(d,"value",ue));let S=e[3]!==""&&je(e);return{c(){t=B("div"),n=B("h1"),n.textContent=s,i=R(),a=B("p"),r=X(e[6]),l=R(),u=B("br"),c=R(),g=X(e[4]),o=R(),F=B("div"),J(d.$$.fragment),Z=R(),m=B("div"),p=B("button"),p.textContent=D,j=R(),k=B("button"),L=X("Download"),P=R(),S&&S.c(),this.h()},l(v){t=y(v,"DIV",{class:!0});var E=C(t);n=y(E,"H1",{class:!0,"data-svelte-h":!0}),oe(n)!=="svelte-1jv2u68"&&(n.textContent=s),i=A(E),a=y(E,"P",{class:!0});var T=C(a);r=W(T,e[6]),l=A(T),u=y(T,"BR",{}),c=A(T),g=W(T,e[4]),T.forEach(w),o=A(E),F=y(E,"DIV",{class:!0});var _=C(F);Q(d.$$.fragment,_),_.forEach(w),Z=A(E),m=y(E,"DIV",{});var z=C(m);p=y(z,"BUTTON",{class:!0,"data-svelte-h":!0}),oe(p)!=="svelte-1xc109j"&&(p.textContent=D),j=A(z),k=y(z,"BUTTON",{class:!0});var M=C(k);L=W(M,"Download"),M.forEach(w),z.forEach(w),P=A(E),S&&S.l(E),E.forEach(w),this.h()},h(){h(n,"class","svelte-1vaxzue"),h(a,"class","progress-bar-status svelte-1vaxzue"),h(F,"class","progress-bar svelte-1vaxzue"),h(p,"class","svelte-1vaxzue"),k.disabled=U=e[5]==="",h(k,"class","svelte-1vaxzue"),h(t,"class","container svelte-1vaxzue")},m(v,E){G(v,t,E),b(t,n),b(t,i),b(t,a),b(a,r),b(a,l),b(a,u),b(a,c),b(a,g),b(t,o),b(t,F),$(d,F,null),b(t,Z),b(t,m),b(m,p),b(m,j),b(m,k),b(k,L),b(t,P),S&&S.m(t,null),N=!0,V||(K=[ne(p,"click",e[7]),ne(k,"click",e[8])],V=!0)},p(v,E){(!N||E&64)&&Se(r,v[6]),(!N||E&16)&&Se(g,v[4]);const T={};!f&&E&2&&(f=!0,T.value=v[1],he(()=>f=!1)),d.$set(T),(!N||E&32&&U!==(U=v[5]===""))&&(k.disabled=U),v[3]!==""?S?S.p(v,E):(S=je(v),S.c(),S.m(t,null)):S&&(S.d(1),S=null)},i(v){N||(q(d.$$.fragment,v),N=!0)},o(v){Y(d.$$.fragment,v),N=!1},d(v){v&&w(t),e[9](null),ee(d),S&&S.d(),V=!1,ye(K)}}}function Nt(e){let t,n;return t=new Ie({props:{currentStage:e[0],stage:3,$$slots:{default:[Et]},$$scope:{ctx:e}}}),{c(){J(t.$$.fragment)},l(s){Q(t.$$.fragment,s)},m(s,i){$(t,s,i),n=!0},p(s,[i]){const a={};i&1&&(a.currentStage=s[0]),i&8318&&(a.$$scope={dirty:i,ctx:s}),t.$set(a)},i(s){n||(q(t.$$.fragment,s),n=!0)},o(s){Y(t.$$.fragment,s),n=!1},d(s){ee(t,s)}}}function Lt(e,t,n){let s,i;_e(e,re,m=>n(11,i=m));let{activeStage:a}=t,r,l=0,u="",c="",g="";const o={RESIZE:.05,SPLIT_FULL_SIZE:.075,SPLIT_HALF_SIZE:.1,CONVERT_FULL_SIZE:.65,CONVERT_HALF_SIZE:.95,ZIP:1};async function F(){if(n(3,u=""),n(4,c=""),r.set(0),i.mapImage===null){n(3,u="No map image has been uploaded");return}n(4,c="Resizing map image to half-size");const m=await Ve(i.mapImage,{type:"scale",x:.5,y:.5});r.set(o.RESIZE),n(4,c=`Splitting full size map into tiles (0 / ${i.tilesX*i.tilesY})`);const p=await ze(i.mapImage,i.tilesX,i.tilesY,(I,S,v)=>{n(4,c=`Splitting full size map into tiles (${S} / ${v})`),r.set(I*(o.SPLIT_FULL_SIZE-o.RESIZE)+o.RESIZE)});n(4,c=`Splitting half size map into tiles (0 / ${i.tilesX*i.tilesY})`);const D=await ze(m,i.tilesX,i.tilesY,(I,S,v)=>{n(4,c=`Splitting half size map into tiles (${S} / ${v})`),r.set(I*(o.SPLIT_HALF_SIZE-o.SPLIT_FULL_SIZE)+o.SPLIT_FULL_SIZE)});n(4,c=`Converting full size tiles into .basis files (0 / ${p.length})`);const j=await Ce(p.map(I=>{const{x:S,y:v,image:E}=I;return{name:`tile_${S}_${v}@1x.basis`,image:E}}),2,(I,S,v)=>{n(4,c=`Converting full size tiles into .basis files (${S} / ${v})`),r.set(I*(o.CONVERT_FULL_SIZE-o.SPLIT_HALF_SIZE)+o.SPLIT_HALF_SIZE)});n(4,c=`Converting half size tiles into .basis files (0 / ${D.length})`);const k=await Ce(D.map(I=>{const{x:S,y:v,image:E}=I;return{name:`tile_${S}_${v}@0.5x.basis`,image:E}}),2,(I,S,v)=>{n(4,c=`Converting half size tiles into .basis files (${S} / ${v})`),r.set(I*(o.CONVERT_HALF_SIZE-o.CONVERT_FULL_SIZE)+o.CONVERT_FULL_SIZE)}),L=j.map(I=>new File([I.file],I.name)),U=k.map(I=>new File([I.file],I.name)),P=(await Promise.all(p.map(async({x:I,y:S,image:v})=>({file:await et(v),name:`tile_${I}_${S}@1x.png`})))).map(I=>new File([I.file],I.name));n(4,c="Zipping files");const[N,V,K]=await Promise.all([pe(L).blob(),pe(U).blob(),pe(P).blob()]),ue=await pe([{name:"1xBasis.zip",input:N},{name:"0.5xBasis.zip",input:V},{name:"PNGs.zip",input:K}]).blob();n(5,g=URL.createObjectURL(ue)),n(4,c="Done!"),r.set(o.ZIP)}function d(){const m=document.createElement("a");m.href=g,m.download="bgTiles.zip",m.click()}function f(m){O[m?"unshift":"push"](()=>{r=m,n(2,r)})}function Z(m){l=m,n(1,l)}return e.$$set=m=>{"activeStage"in m&&n(0,a=m.activeStage)},e.$$.update=()=>{e.$$.dirty&2&&n(6,s=`${(l*100).toFixed(2)}%`)},[a,l,r,u,c,g,s,F,d,f,Z]}class zt extends ce{constructor(t){super(),ge(this,t,Lt,Nt,fe,{activeStage:0})}}function Pe(e){let t;return{c(){t=X(e[6])},l(n){t=W(n,e[6])},m(n,s){G(n,t,s)},p(n,s){s&64&&Se(t,n[6])},d(n){n&&w(t)}}}function Ct(e){let t,n,s,i,a,r,l,u,c,g,o,F,d,f,Z,m,p,D,j,k,L,U,P,N,V,K;function ue(_){e[10](_)}function I(_){e[11](_)}let S={activeStage:e[1]};e[6]!==void 0&&(S.canGoToNextStage=e[6]),e[3]!==void 0&&(S.disableAdvanceStageButtons=e[3]),i=new ct({props:S}),e[9](i),O.push(()=>be(i,"canGoToNextStage",ue)),O.push(()=>be(i,"disableAdvanceStageButtons",I));function v(_){e[13](_)}let E={activeStage:e[1]};e[6]!==void 0&&(E.canGoToNextStage=e[6]),u=new pt({props:E}),e[12](u),O.push(()=>be(u,"canGoToNextStage",v)),o=new zt({props:{activeStage:e[1]}});let T=typeof e[6]=="string"&&Pe(e);return{c(){t=R(),n=B("div"),s=B("form"),J(i.$$.fragment),l=R(),J(u.$$.fragment),g=R(),J(o.$$.fragment),F=R(),d=B("div"),f=B("div"),T&&T.c(),Z=R(),m=B("div"),p=B("button"),D=X("Back"),k=R(),L=B("button"),U=X("Next"),this.h()},l(_){Qe("svelte-1u9xhe4",document.head).forEach(w),t=A(_),n=y(_,"DIV",{class:!0});var M=C(n);s=y(M,"FORM",{class:!0,name:!0,id:!0});var H=C(s);Q(i.$$.fragment,H),l=A(H),Q(u.$$.fragment,H),g=A(H),Q(o.$$.fragment,H),F=A(H),d=y(H,"DIV",{class:!0});var te=C(d);f=y(te,"DIV",{class:!0});var Te=C(f);T&&T.l(Te),Te.forEach(w),Z=A(te),m=y(te,"DIV",{class:!0});var de=C(m);p=y(de,"BUTTON",{"data-direction":!0,class:!0});var Fe=C(p);D=W(Fe,"Back"),Fe.forEach(w),k=A(de),L=y(de,"BUTTON",{"data-direction":!0,class:!0});var Ee=C(L);U=W(Ee,"Next"),Ee.forEach(w),de.forEach(w),te.forEach(w),H.forEach(w),M.forEach(w),this.h()},h(){document.title="File Generator",h(f,"class","error svelte-1llijee"),h(p,"data-direction","back"),p.disabled=j=e[3]||e[1]===1||typeof e[6]=="string"&&!0,h(p,"class","svelte-1llijee"),h(L,"data-direction","forward"),L.disabled=P=e[3]||e[1]===e[2]||typeof e[6]=="string"&&!0,h(L,"class","svelte-1llijee"),h(m,"class","submit-button-container svelte-1llijee"),h(d,"class","submit svelte-1llijee"),h(s,"class","scrolling-form"),h(s,"name","fileGeneratorForm"),h(s,"id","fileGeneratorForm"),h(n,"class","form-container svelte-1llijee")},m(_,z){G(_,t,z),G(_,n,z),b(n,s),$(i,s,null),b(s,l),$(u,s,null),b(s,g),$(o,s,null),b(s,F),b(s,d),b(d,f),T&&T.m(f,null),b(d,Z),b(d,m),b(m,p),b(p,D),b(m,k),b(m,L),b(L,U),e[16](s),N=!0,V||(K=[ne(p,"click",we(e[14])),ne(L,"click",we(e[15])),ne(s,"submit",we(e[8]))],V=!0)},p(_,[z]){const M={};z&2&&(M.activeStage=_[1]),!a&&z&64&&(a=!0,M.canGoToNextStage=_[6],he(()=>a=!1)),!r&&z&8&&(r=!0,M.disableAdvanceStageButtons=_[3],he(()=>r=!1)),i.$set(M);const H={};z&2&&(H.activeStage=_[1]),!c&&z&64&&(c=!0,H.canGoToNextStage=_[6],he(()=>c=!1)),u.$set(H);const te={};z&2&&(te.activeStage=_[1]),o.$set(te),typeof _[6]=="string"?T?T.p(_,z):(T=Pe(_),T.c(),T.m(f,null)):T&&(T.d(1),T=null),(!N||z&74&&j!==(j=_[3]||_[1]===1||typeof _[6]=="string"&&!0))&&(p.disabled=j),(!N||z&78&&P!==(P=_[3]||_[1]===_[2]||typeof _[6]=="string"&&!0))&&(L.disabled=P)},i(_){N||(q(i.$$.fragment,_),q(u.$$.fragment,_),q(o.$$.fragment,_),N=!0)},o(_){Y(i.$$.fragment,_),Y(u.$$.fragment,_),Y(o.$$.fragment,_),N=!1},d(_){_&&(w(t),w(n)),e[9](null),ee(i),e[12](null),ee(u),ee(o),T&&T.d(),e[16](null),V=!1,ye(K)}}}function Rt(e,t,n){var L;const s={};let i,a=1,r=1,l=!1,u,c,g=((L=s[a])==null?void 0:L.call(s))??!0;function o(U){var P,N;n(6,g=((P=s[a])==null?void 0:P.call(s))??!0),typeof g!="string"&&(n(1,a=st(a+(U==="back"?-1:1),1,r)),n(6,g=((N=s[a])==null?void 0:N.call(s))??!0))}Ke(()=>{var N;const U=[...i.children].filter(V=>V.getAttribute("data-form-stage")!==null);let P=U.length;n(2,r=P);for(let V=0;V<P;V++)U[V].setAttribute("data-stage",V.toString());s[1]=u.isStageComplete,s[2]=c.isStageComplete,n(6,g=((N=s[a])==null?void 0:N.call(s))??!0)});function F(U){Je.call(this,e,U)}function d(U){O[U?"unshift":"push"](()=>{u=U,n(4,u)})}function f(U){g=U,n(6,g)}function Z(U){l=U,n(3,l)}function m(U){O[U?"unshift":"push"](()=>{c=U,n(5,c)})}function p(U){g=U,n(6,g)}const D=()=>{o("back")},j=()=>{o("forward")};function k(U){O[U?"unshift":"push"](()=>{i=U,n(0,i)})}return[i,a,r,l,u,c,g,o,F,d,f,Z,m,p,D,j,k]}class Gt extends ce{constructor(t){super(),ge(this,t,Rt,Ct,fe,{})}}export{Gt as component};
