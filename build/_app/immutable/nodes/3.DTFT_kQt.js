import{a as R,j as Z,o as ee,A as F,d as U,B as ne,r as ae,c as le,u as re,g as oe,b as ie}from"../chunks/scheduler.CEYuN9sw.js";import{S as z,i as G,c as L,d as N,m as X,t as j,l as H,n as k,B as ue,e as y,s as D,a as I,b as Y,q as S,f as E,g as T,h as g,C as O,j as B,k as _,o as W,p as q,x as pe,r as J}from"../chunks/index.C0VDjlZ-.js";import{b as K}from"../chunks/paths.dFhn3uZf.js";import{T as fe,a as Q}from"../chunks/ToolbarItem.DSxsL2hu.js";import{s as P,S as me}from"../chunks/store.B0hQ9vkm.js";import{a as ce,b as de}from"../chunks/imageUtils.D3mPm3B8.js";import{D as te}from"../chunks/Dialog.Cj81w0u7.js";import{D as he,P as ge}from"../chunks/DragDropUpload.8gnmLnO_.js";function $e(r){let e,t=`Drag and drop your .basis files here (in 1 go), or click to upload a
        file.`,n,a,s;return{c(){e=y("p"),e.textContent=t,n=D(),a=y("span"),s=W(r[1]),this.h()},l(l){e=I(l,"P",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-1isbihn"&&(e.textContent=t),n=E(l),a=I(l,"SPAN",{class:!0});var p=Y(a);s=q(p,r[1]),p.forEach(T),this.h()},h(){g(e,"class","svelte-13jdnn1"),g(a,"class","error svelte-13jdnn1")},m(l,p){B(l,e,p),B(l,n,p),B(l,a,p),_(a,s)},p(l,p){p&2&&pe(s,l[1])},d(l){l&&(T(e),T(n),T(a))}}}function _e(r){let e,t,n="Upload Map Images",a,s,l="The map images must be in the format: tile_(x)_(y)@(1x OR 0.5x).basis",p,h,C="ie, tile_3_5@0.5x.basis",f,o,M,i,u,m,w;o=new he({props:{mimeType:".basis",multiple:!0,onFileUpload:r[4],$$slots:{default:[$e]},$$scope:{ctx:r}}});function A(v){r[6](v)}let b={containerStyles:{"border-color":"red"}};return r[2]!==void 0&&(b.value=r[2]),u=new ge({props:b}),U.push(()=>ue(u,"value",A)),r[7](u),{c(){e=y("div"),t=y("h1"),t.textContent=n,a=D(),s=y("p"),s.textContent=l,p=D(),h=y("p"),h.textContent=C,f=D(),L(o.$$.fragment),M=D(),i=y("div"),L(u.$$.fragment),this.h()},l(v){e=I(v,"DIV",{class:!0});var x=Y(e);t=I(x,"H1",{class:!0,"data-svelte-h":!0}),S(t)!=="svelte-d8o6tz"&&(t.textContent=n),a=E(x),s=I(x,"P",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-lya26t"&&(s.textContent=l),p=E(x),h=I(x,"P",{class:!0,"data-svelte-h":!0}),S(h)!=="svelte-1gtbz8v"&&(h.textContent=C),f=E(x),N(o.$$.fragment,x),M=E(x),i=I(x,"DIV",{class:!0});var c=Y(i);N(u.$$.fragment,c),c.forEach(T),x.forEach(T),this.h()},h(){g(t,"class","svelte-13jdnn1"),g(s,"class","svelte-13jdnn1"),g(h,"class","svelte-13jdnn1"),g(i,"class","progress-bar svelte-13jdnn1"),O(i,"hidden",r[2]===0),g(e,"class","dialog svelte-13jdnn1")},m(v,x){B(v,e,x),_(e,t),_(e,a),_(e,s),_(e,p),_(e,h),_(e,f),X(o,e,null),_(e,M),_(e,i),X(u,i,null),w=!0},p(v,x){const c={};x&1026&&(c.$$scope={dirty:x,ctx:v}),o.$set(c);const d={};!m&&x&4&&(m=!0,d.value=v[2],ne(()=>m=!1)),u.$set(d),(!w||x&4)&&O(i,"hidden",v[2]===0)},i(v){w||(j(o.$$.fragment,v),j(u.$$.fragment,v),w=!0)},o(v){H(o.$$.fragment,v),H(u.$$.fragment,v),w=!1},d(v){v&&T(e),k(o),r[7](null),k(u)}}}function ve(r){let e,t,n={$$slots:{default:[_e]},$$scope:{ctx:r}};return e=new te({props:n}),r[8](e),{c(){L(e.$$.fragment)},l(a){N(e.$$.fragment,a)},m(a,s){X(e,a,s),t=!0},p(a,[s]){const l={};s&1038&&(l.$$scope={dirty:s,ctx:a}),e.$set(l)},i(a){t||(j(e.$$.fragment,a),t=!0)},o(a){H(e.$$.fragment,a),t=!1},d(a){r[8](null),k(e,a)}}}const be=/^tile_\d+_\d+@(1|0.5)x\.basis$/;function xe(r,e,t){let n;Z(r,P,i=>t(9,n=i));const a={modal:null};let s,l="",p=0,h;async function C(i){var x;if(t(1,l=""),n.viewport===null){t(1,l="Error: App is not initialised. This shouldn't happen...");return}if(i.length===0)return;const u=(x=i.find(c=>!be.test(c.name)))==null?void 0:x.name;if(u!==void 0){t(1,l=`Invalid file name: ${u}`);return}const m=i.map(c=>{const d=c.name.slice(0,-7).split(/_|@/g),$=parseInt(d[1]),V=parseInt(d[2]),se=parseInt(d[3]);return{x:$,y:V,resolution:se}}),w=Math.max(...m.map(c=>c.x))+1,A=Math.max(...m.map(c=>c.y))+1;if(m.length!==w*A){const c=[];for(let d=0;d<w;d++)for(let $=0;$<A;$++)m.find(V=>V.x===d&&V.y===$)===void 0&&c.push({x:d,y:$});t(1,l=`Some tiles are missing. First, do you intend to have ${w}x${A} tiles? If so, then you are missing these tiles: ${c.map(d=>`(${d.x},${d.y})`).join(", ")}`);return}const b=await ce(i.map(c=>({file:c,name:c.name})),2,c=>{h.set(c)});F(P,n.mapDimensions={x:b.tileWidth*w,y:b.tileHeight*A},n);const v=b.tiles.map(c=>{const d=me.from(de(c.image));return d.x=c.x*b.tileWidth,d.y=c.y*b.tileHeight,d.cullable=!0,d.label=`Tile (${c.x}, ${c.y})`,d});n.viewport.children.forEach(c=>c.removeChildren().forEach(d=>d.destroy)),n.backgroundLayer.addChild(...v),F(P,n.viewport.worldWidth=n.mapDimensions.x,n),F(P,n.viewport.worldHeight=n.mapDimensions.y,n),n.viewport.centerViewport(),n.hexGridLayer.populate(n.mapDimensions,n.viewport,n.hexesX,n.hexesY)}ee(()=>{t(5,a.modal=s,a)});function f(i){p=i,t(2,p)}function o(i){U[i?"unshift":"push"](()=>{h=i,t(3,h)})}function M(i){U[i?"unshift":"push"](()=>{s=i,t(0,s)})}return[s,l,p,h,C,a,f,o,M]}class Ce extends z{constructor(e){super(),G(this,e,xe,ve,R,{exports:5})}get exports(){return this.$$.ctx[5]}}function we(r){let e,t,n="Hex Count",a,s,l,p,h="X:",C,f,o,M,i,u,m,w="Y:",A,b,v,x,c;return{c(){e=y("div"),t=y("h1"),t.textContent=n,a=D(),s=y("br"),l=D(),p=y("label"),p.textContent=h,C=D(),f=y("input"),M=D(),i=y("br"),u=D(),m=y("label"),m.textContent=w,A=D(),b=y("input"),this.h()},l(d){e=I(d,"DIV",{class:!0});var $=Y(e);t=I($,"H1",{class:!0,"data-svelte-h":!0}),S(t)!=="svelte-c4bxn4"&&(t.textContent=n),a=E($),s=I($,"BR",{class:!0}),l=E($),p=I($,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),S(p)!=="svelte-vvw4xn"&&(p.textContent=h),C=E($),f=I($,"INPUT",{id:!0,name:!0,type:!0,min:!0,step:!0,class:!0}),M=E($),i=I($,"BR",{class:!0}),u=E($),m=I($,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),S(m)!=="svelte-tr29dr"&&(m.textContent=w),A=E($),b=I($,"INPUT",{id:!0,name:!0,type:!0,min:!0,step:!0,class:!0}),$.forEach(T),this.h()},h(){g(t,"class","svelte-m378fu"),g(s,"class","svelte-m378fu"),g(p,"for","hexesX"),g(p,"class","svelte-m378fu"),g(f,"id","hexesX"),g(f,"name","hexesX"),g(f,"type","number"),g(f,"min",1),g(f,"step",1),f.value=o=r[1].hexesX,g(f,"class","svelte-m378fu"),g(i,"class","svelte-m378fu"),g(m,"for","hexesY"),g(m,"class","svelte-m378fu"),g(b,"id","hexesY"),g(b,"name","hexesY"),g(b,"type","number"),g(b,"min",1),g(b,"step",1),b.value=v=r[1].hexesY,g(b,"class","svelte-m378fu"),g(e,"class","dialog svelte-m378fu")},m(d,$){B(d,e,$),_(e,t),_(e,a),_(e,s),_(e,l),_(e,p),_(e,C),_(e,f),_(e,M),_(e,i),_(e,u),_(e,m),_(e,A),_(e,b),x||(c=[J(f,"change",r[3]),J(b,"change",r[4])],x=!0)},p(d,$){$&2&&o!==(o=d[1].hexesX)&&f.value!==o&&(f.value=o),$&2&&v!==(v=d[1].hexesY)&&b.value!==v&&(b.value=v)},d(d){d&&T(e),x=!1,ae(c)}}}function ye(r){let e,t,n={$$slots:{default:[we]},$$scope:{ctx:r}};return e=new te({props:n}),r[5](e),{c(){L(e.$$.fragment)},l(a){N(e.$$.fragment,a)},m(a,s){X(e,a,s),t=!0},p(a,[s]){const l={};s&130&&(l.$$scope={dirty:s,ctx:a}),e.$set(l)},i(a){t||(j(e.$$.fragment,a),t=!0)},o(a){H(e.$$.fragment,a),t=!1},d(a){r[5](null),k(e,a)}}}function Ie(r,e,t){let n;Z(r,P,f=>t(1,n=f));const a={modal:null};let s;const l={x:n.hexesX,y:n.hexesY};P.subscribe(({hexesX:f,hexesY:o})=>{n.viewport===null||l.x===f&&l.y===o||n.hexGridLayer.populate(n.mapDimensions,n.viewport,f,o)}),ee(()=>{t(2,a.modal=s,a)});const p=f=>{const o=parseInt(f.currentTarget.value);F(P,n.hexesX=isNaN(o)?1:Math.max(Math.floor(o),1),n)},h=f=>{const o=parseInt(f.currentTarget.value);F(P,n.hexesY=isNaN(o)?1:Math.max(Math.floor(o),1),n)};function C(f){U[f?"unshift":"push"](()=>{s=f,t(0,s)})}return[s,n,a,p,h,C]}class De extends z{constructor(e){super(),G(this,e,Ie,ye,R,{exports:2})}get exports(){return this.$$.ctx[2]}}function Ee(r){let e;return{c(){e=W("Upload Map Images")},l(t){e=q(t,"Upload Map Images")},m(t,n){B(t,e,n)},d(t){t&&T(e)}}}function Te(r){let e;return{c(){e=W("Hexes")},l(t){e=q(t,"Hexes")},m(t,n){B(t,e,n)},d(t){t&&T(e)}}}function Me(r){let e,t,n,a;return e=new Q({props:{imageSRC:K+"/upload.png",imageAltText:"An upload icon",onClick:r[3],$$slots:{default:[Ee]},$$scope:{ctx:r}}}),n=new Q({props:{imageSRC:K+"/hex_grid.png",imageAltText:"A honeycomb",onClick:r[4],$$slots:{default:[Te]},$$scope:{ctx:r}}}),{c(){L(e.$$.fragment),t=D(),L(n.$$.fragment)},l(s){N(e.$$.fragment,s),t=E(s),N(n.$$.fragment,s)},m(s,l){X(e,s,l),B(s,t,l),X(n,s,l),a=!0},p(s,l){const p={};l&1&&(p.onClick=s[3]),l&128&&(p.$$scope={dirty:l,ctx:s}),e.$set(p);const h={};l&2&&(h.onClick=s[4]),l&128&&(h.$$scope={dirty:l,ctx:s}),n.$set(h)},i(s){a||(j(e.$$.fragment,s),j(n.$$.fragment,s),a=!0)},o(s){H(e.$$.fragment,s),H(n.$$.fragment,s),a=!1},d(s){s&&T(t),k(e,s),k(n,s)}}}function Ae(r){let e,t,n,a,s,l,p,h,C;t=new fe({props:{$$slots:{default:[Me]},$$scope:{ctx:r}}});let f={};a=new Ce({props:f}),r[5](a);let o={};l=new De({props:o}),r[6](l);const M=r[2].default,i=le(M,r,r[7],null);return{c(){e=y("div"),L(t.$$.fragment),n=D(),L(a.$$.fragment),s=D(),L(l.$$.fragment),p=D(),h=y("div"),i&&i.c(),this.h()},l(u){e=I(u,"DIV",{class:!0});var m=Y(e);N(t.$$.fragment,m),n=E(m),N(a.$$.fragment,m),s=E(m),N(l.$$.fragment,m),p=E(m),h=I(m,"DIV",{class:!0});var w=Y(h);i&&i.l(w),w.forEach(T),m.forEach(T),this.h()},h(){g(h,"class","main svelte-zhdu1g"),g(e,"class","container svelte-zhdu1g")},m(u,m){B(u,e,m),X(t,e,null),_(e,n),X(a,e,null),_(e,s),X(l,e,null),_(e,p),_(e,h),i&&i.m(h,null),C=!0},p(u,[m]){const w={};m&131&&(w.$$scope={dirty:m,ctx:u}),t.$set(w);const A={};a.$set(A);const b={};l.$set(b),i&&i.p&&(!C||m&128)&&re(i,M,u,u[7],C?ie(M,u[7],m,null):oe(u[7]),null)},i(u){C||(j(t.$$.fragment,u),j(a.$$.fragment,u),j(l.$$.fragment,u),j(i,u),C=!0)},o(u){H(t.$$.fragment,u),H(a.$$.fragment,u),H(l.$$.fragment,u),H(i,u),C=!1},d(u){u&&T(e),k(t),r[5](null),k(a),r[6](null),k(l),i&&i.d(u)}}}function je(r,e,t){let{$$slots:n={},$$scope:a}=e,s,l;const p=()=>{var o;(o=s.exports.modal)==null||o.toggle()},h=()=>{var o;(o=l.exports.modal)==null||o.toggle()};function C(o){U[o?"unshift":"push"](()=>{s=o,t(0,s)})}function f(o){U[o?"unshift":"push"](()=>{l=o,t(1,l)})}return r.$$set=o=>{"$$scope"in o&&t(7,a=o.$$scope)},[s,l,n,p,h,C,f,a]}class Ue extends z{constructor(e){super(),G(this,e,je,Ae,R,{})}}export{Ue as component};
