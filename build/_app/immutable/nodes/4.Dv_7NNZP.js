import{B as ee,C as te,x as z,m as se,r as ne,a as X,n as j,e as Q,f as le,o as ae,d as ce}from"../chunks/scheduler.CWFRzsjZ.js";import{z as q,l as P,x as B,t as T,S as Y,i as Z,e as x,o as oe,s as A,a as $,b as D,p as re,g,f as E,r as S,h as b,j as k,k as U,v as he,B as ie,w as V,c as ue,d as de,m as pe,n as fe}from"../chunks/index.BXGTNUih.js";import{b as G}from"../chunks/paths.Dl56lNOo.js";import{l as me,d as _e}from"../chunks/database.DuigGXD_.js";import{a as ge}from"../chunks/imageUtils.Ch6fHfqa.js";function F(n,e){const s=e.token={};function t(c,l,r,o){if(e.token!==s)return;e.resolved=o;let a=e.ctx;r!==void 0&&(a=a.slice(),a[r]=o);const i=c&&(e.current=c)(a);let d=!1;e.block&&(e.blocks?e.blocks.forEach((_,h)=>{h!==l&&_&&(q(),P(_,1,1,()=>{e.blocks[h]===_&&(e.blocks[h]=null)}),B())}):e.block.d(1),i.c(),T(i,1),i.m(e.mount(),e.anchor),d=!0),e.block=i,e.blocks&&(e.blocks[l]=i),d&&se()}if(ee(n)){const c=te();if(n.then(l=>{z(c),t(e.then,1,e.value,l),z(null)},l=>{if(z(c),t(e.catch,2,e.error,l),z(null),!e.hasCatch)throw l}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function ve(n,e,s){const t=e.slice(),{resolved:c}=n;n.current===n.then&&(t[n.value]=c),n.current===n.catch&&(t[n.error]=c),n.block.p(t,s)}function J(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function be(n,e){P(n,1,1,()=>{e.delete(n.key)})}function we(n,e,s,t,c,l,r,o,a,i,d,_){let h=n.length,p=l.length,f=h;const M={};for(;f--;)M[n[f].key]=f;const R=[],w=new Map,y=new Map,u=[];for(f=p;f--;){const m=_(c,l,f),H=s(m);let I=r.get(H);I?u.push(()=>I.p(m,e)):(I=i(H,m),I.c()),w.set(H,R[f]=I),H in M&&y.set(H,Math.abs(f-M[H]))}const v=new Set,C=new Set;function W(m){T(m,1),m.m(o,d),r.set(m.key,m),d=m.first,p--}for(;h&&p;){const m=R[p-1],H=n[h-1],I=m.key,L=H.key;m===H?(d=m.first,h--,p--):w.has(L)?!r.has(I)||v.has(I)?W(m):C.has(L)?h--:y.get(I)>y.get(L)?(C.add(I),W(m)):(v.add(L),h--):(a(H,r),h--)}for(;h--;){const m=n[h];w.has(m.key)||a(m,r)}for(;p;)W(R[p-1]);return ne(u),R}function ke(n){return{c:j,l:j,m:j,p:j,d:j}}function Ce(n){let e,s;return{c(){e=x("img"),this.h()},l(t){e=$(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Q(e.src,s=n[1].src)||b(e,"src",s),b(e,"alt","Thumbnail"),b(e,"class","thumbnail svelte-1npg1hj")},m(t,c){k(t,e,c)},p(t,c){c&2&&!Q(e.src,s=t[1].src)&&b(e,"src",s)},d(t){t&&g(e)}}}function je(n){let e,s="Image loading...";return{c(){e=x("p"),e.textContent=s},l(t){e=$(t,"P",{"data-svelte-h":!0}),S(e)!=="svelte-9u03uz"&&(e.textContent=s)},m(t,c){k(t,e,c)},p:j,d(t){t&&g(e)}}}function xe(n){let e,s,t=(n[0].name??"Unnamed Project")+"",c,l,r,o,a,i="asd",d={ctx:n,current:null,token:null,hasCatch:!1,pending:je,then:Ce,catch:ke,value:1};return F(r=n[1],d),{c(){e=x("div"),s=x("h3"),c=oe(t),l=A(),d.block.c(),o=A(),a=x("div"),a.textContent=i,this.h()},l(_){e=$(_,"DIV",{class:!0});var h=D(e);s=$(h,"H3",{class:!0});var p=D(s);c=re(p,t),p.forEach(g),l=E(h),d.block.l(h),o=E(h),a=$(h,"DIV",{class:!0,"data-svelte-h":!0}),S(a)!=="svelte-1lls3la"&&(a.textContent=i),h.forEach(g),this.h()},h(){b(s,"class","svelte-1npg1hj"),b(a,"class","footer svelte-1npg1hj"),b(e,"class","project svelte-1npg1hj")},m(_,h){k(_,e,h),U(e,s),U(s,c),U(e,l),d.block.m(e,d.anchor=null),d.mount=()=>e,d.anchor=o,U(e,o),U(e,a)},p(_,[h]){n=_,h&1&&t!==(t=(n[0].name??"Unnamed Project")+"")&&he(c,t),d.ctx=n,h&2&&r!==(r=n[1])&&F(r,d)||ve(d,n,h)},i:j,o:j,d(_){_&&g(e),d.block.d(),d.token=null,d=null}}}function $e(n,e,s){let t,{project:c}=e;return n.$$set=l=>{"project"in l&&s(0,c=l.project)},n.$$.update=()=>{n.$$.dirty&1&&s(1,t=c.thumbnail!==null?ge(c.thumbnail.buffer):new Promise(l=>{const r=new Image;r.onload=()=>{l(r)},r.src=`${G}/no_image.png`}))},[c,t]}class He extends Y{constructor(e){super(),Z(this,e,$e,xe,X,{project:0})}}class N{constructor(e="",s=!0){this.hash=e,this.autoUpdateWindowHash=s}static fromWindow(e=!0){return new N(window.location.hash.slice(1),e)}updateWindowHash(){return window.location.hash=this.hash===""?"":`#${this.hash}`,this.hash}get(e){return this.getAllHashes()[e]??null}set(e,s){const t=this.getHashString(e,s);return this.contains(e)?this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),`${t},`):(this.hash!==""&&(this.hash+=","),this.hash+=`${t}`),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),this.hash}delete(e){if(!this.contains(e))return null;const s=this.get(e);return this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),",").replace(/,+/,","),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),s}contains(e){return new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`).test(this.hash)}getAllHashes(){const e=this.hash.split(","),s={};for(const t of e){if(t==="")continue;const c=t.split("="),l=decodeURIComponent(c[0]),r=decodeURIComponent(c[1]);s[l]=r}return s}getHashString(e,s){return`${encodeURIComponent(e)}=${encodeURIComponent(s)}`}removeLeadingAndTrailingCommas(){var t,c,l,r;if(!this.hash.startsWith(",")&&!this.hash.endsWith(","))return this.hash;const e=((c=(t=this.hash.match(/^,+/))==null?void 0:t[0])==null?void 0:c.length)??0,s=-(((r=(l=this.hash.match(/,+$/))==null?void 0:l[0])==null?void 0:r.length)??-this.hash.length);return this.hash=this.hash.slice(e,s),this.hash}}function K(n,e,s){const t=n.slice();return t[5]=e[s],t}function Ie(n){let e,s="Work in progress! Saving projects are not supported yet";return{c(){e=x("h3"),e.textContent=s,this.h()},l(t){e=$(t,"H3",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-zpyi1"&&(e.textContent=s),this.h()},h(){b(e,"class","svelte-thco81")},m(t,c){k(t,e,c)},p:j,i:j,o:j,d(t){t&&g(e)}}}function Me(n){let e=[],s=new Map,t,c,l=J(n[0]??[]);const r=o=>o[5].id;for(let o=0;o<l.length;o+=1){let a=K(n,l,o),i=r(a);s.set(i,e[o]=O(i,a))}return{c(){for(let o=0;o<e.length;o+=1)e[o].c();t=V()},l(o){for(let a=0;a<e.length;a+=1)e[a].l(o);t=V()},m(o,a){for(let i=0;i<e.length;i+=1)e[i]&&e[i].m(o,a);k(o,t,a),c=!0},p(o,a){a&1&&(l=J(o[0]??[]),q(),e=we(e,a,r,1,o,l,s,t.parentNode,be,O,t,K),B())},i(o){if(!c){for(let a=0;a<l.length;a+=1)T(e[a]);c=!0}},o(o){for(let a=0;a<e.length;a+=1)P(e[a]);c=!1},d(o){o&&g(t);for(let a=0;a<e.length;a+=1)e[a].d(o)}}}function O(n,e){let s,t,c;return t=new He({props:{project:e[5]}}),{key:n,first:null,c(){s=V(),ue(t.$$.fragment),this.h()},l(l){s=V(),de(t.$$.fragment,l),this.h()},h(){this.first=s},m(l,r){k(l,s,r),pe(t,l,r),c=!0},p(l,r){e=l;const o={};r&1&&(o.project=e[5]),t.$set(o)},i(l){c||(T(t.$$.fragment,l),c=!0)},o(l){P(t.$$.fragment,l),c=!1},d(l){l&&g(s),fe(t,l)}}}function Ue(n){let e,s,t="Melvor Map Maker",c,l,r="",o,a,i,d="Saved Projects",_,h,p,f,M;const R=[Me,Ie],w=[];function y(u,v){return u[2]>0?0:1}return p=y(n),f=w[p]=R[p](n),{c(){e=A(),s=x("h1"),s.textContent=t,c=A(),l=x("a"),l.innerHTML=r,o=A(),a=x("div"),i=x("h2"),i.textContent=d,_=A(),h=x("div"),f.c(),this.h()},l(u){ie("svelte-1bq5zbc",document.head).forEach(g),e=E(u),s=$(u,"H1",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-1w6u9bb"&&(s.textContent=t),c=E(u),l=$(u,"A",{href:!0,class:!0,"data-svelte-h":!0}),S(l)!=="svelte-1vm4tsh"&&(l.innerHTML=r),o=E(u),a=$(u,"DIV",{class:!0});var C=D(a);i=$(C,"H2",{"data-svelte-h":!0}),S(i)!=="svelte-1cctxi5"&&(i.textContent=d),_=E(C),h=$(C,"DIV",{class:!0});var W=D(h);f.l(W),W.forEach(g),C.forEach(g),this.h()},h(){document.title="Melvor Map Maker",b(s,"class","svelte-thco81"),b(l,"href",G),b(l,"class","svelte-thco81"),b(h,"class","project-container svelte-thco81"),b(a,"class","projects svelte-thco81")},m(u,v){k(u,e,v),k(u,s,v),k(u,c,v),k(u,l,v),n[4](l),k(u,o,v),k(u,a,v),U(a,i),U(a,_),U(a,h),w[p].m(h,null),M=!0},p(u,[v]){let C=p;p=y(u),p===C?w[p].p(u,v):(q(),P(w[C],1,1,()=>{w[C]=null}),B(),f=w[p],f?f.p(u,v):(f=w[p]=R[p](u),f.c()),T(f,1),f.m(h,null))},i(u){M||(T(f),M=!0)},o(u){P(f),M=!1},d(u){u&&(g(e),g(s),g(c),g(l),g(o),g(a)),n[4](null),w[p].d()}}}function Re(n,e,s){let t,c,l,r=me(()=>_e.projects.toArray());le(n,r,a=>s(0,c=a)),ae(()=>{const i=N.fromWindow().get("route");i!==null&&(s(1,l.href=`${G}/${i}`,l),l.click())});function o(a){ce[a?"unshift":"push"](()=>{l=a,s(1,l)})}return n.$$.update=()=>{n.$$.dirty&1&&s(2,t=(c==null?void 0:c.length)??0)},[c,l,t,r,o]}class Pe extends Y{constructor(e){super(),Z(this,e,Re,Ue,X,{})}}export{Pe as component};
