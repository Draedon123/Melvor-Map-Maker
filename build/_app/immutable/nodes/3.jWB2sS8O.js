import{a as K,c as Q,u as Z,g as ee,b as te,f as se,h as W,d as B,j as ae}from"../chunks/scheduler.CWFRzsjZ.js";import{S as oe,i as ne,e as w,c as H,s as D,a as x,b as N,d as M,f as E,g as v,h as I,j as T,m as U,k as b,t as S,l as A,n as V,o as L,p as O,q as re,r as j,u as X,v as le}from"../chunks/index.DWCIZltW.js";import{b as G}from"../chunks/paths.CNms3DRf.js";import{s as q,S as ie}from"../chunks/store.C2j4PXn_.js";import{f as ue,t as pe}from"../chunks/imageUtils.CWp2MXWB.js";import{D as fe}from"../chunks/Dialog.Bs59iGLG.js";import{T as me,a as Y}from"../chunks/ToolbarItem.DUCP_2Rd.js";import{D as ce,P as de}from"../chunks/ProgressBar.fS7iscKg.js";function ge(l){let e;return{c(){e=L("Upload Map Images")},l(s){e=O(s,"Upload Map Images")},m(s,o){T(s,e,o)},d(s){s&&v(e)}}}function _e(l){let e;return{c(){e=L("Hexes")},l(s){e=O(s,"Hexes")},m(s,o){T(s,e,o)},d(s){s&&v(e)}}}function $e(l){var f;let e,s,o,i;return e=new Y({props:{imageSRC:G+"/upload.png",imageAltText:"An upload icon",imageOnClick:(f=l[0])==null?void 0:f.toggle,$$slots:{default:[ge]},$$scope:{ctx:l}}}),o=new Y({props:{imageSRC:G+"/hex_grid.png",imageAltText:"A honeycomb",$$slots:{default:[_e]},$$scope:{ctx:l}}}),{c(){H(e.$$.fragment),s=D(),H(o.$$.fragment)},l(t){M(e.$$.fragment,t),s=E(t),M(o.$$.fragment,t)},m(t,a){U(e,t,a),T(t,s,a),U(o,t,a),i=!0},p(t,a){var m;const g={};a&1&&(g.imageOnClick=(m=t[0])==null?void 0:m.toggle),a&512&&(g.$$scope={dirty:a,ctx:t}),e.$set(g);const h={};a&512&&(h.$$scope={dirty:a,ctx:t}),o.$set(h)},i(t){i||(S(e.$$.fragment,t),S(o.$$.fragment,t),i=!0)},o(t){A(e.$$.fragment,t),A(o.$$.fragment,t),i=!1},d(t){t&&v(s),V(e,t),V(o,t)}}}function he(l){let e,s=`Drag and drop your .basis files here (in 1 go), or click to upload a
          file.`,o,i,f;return{c(){e=w("p"),e.textContent=s,o=D(),i=w("span"),f=L(l[1]),this.h()},l(t){e=x(t,"P",{class:!0,"data-svelte-h":!0}),j(e)!=="svelte-bqoe3f"&&(e.textContent=s),o=E(t),i=x(t,"SPAN",{class:!0});var a=N(i);f=O(a,l[1]),a.forEach(v),this.h()},h(){I(e,"class","svelte-1uau5oz"),I(i,"class","error svelte-1uau5oz")},m(t,a){T(t,e,a),T(t,o,a),T(t,i,a),b(i,f)},p(t,a){a&2&&le(f,t[1])},d(t){t&&(v(e),v(o),v(i))}}}function ve(l){let e,s,o="Upload Map Images",i,f,t="The map images must be in the format: tile_(x)_(y)@(1x OR 0.5x).basis",a,g,h="ie, tile_3_5@0.5x.basis",m,n,c,_,r,P,C;n=new ce({props:{mimeType:".basis",multiple:!0,onFileUpload:l[4],$$slots:{default:[he]},$$scope:{ctx:l}}});function k(p){l[6](p)}let y={containerStyles:{"border-color":"red"}};return l[2]!==void 0&&(y.value=l[2]),r=new de({props:y}),B.push(()=>re(r,"value",k)),l[7](r),{c(){e=w("div"),s=w("h1"),s.textContent=o,i=D(),f=w("p"),f.textContent=t,a=D(),g=w("p"),g.textContent=h,m=D(),H(n.$$.fragment),c=D(),_=w("div"),H(r.$$.fragment),this.h()},l(p){e=x(p,"DIV",{class:!0});var d=N(e);s=x(d,"H1",{class:!0,"data-svelte-h":!0}),j(s)!=="svelte-d8o6tz"&&(s.textContent=o),i=E(d),f=x(d,"P",{class:!0,"data-svelte-h":!0}),j(f)!=="svelte-1xw0nlr"&&(f.textContent=t),a=E(d),g=x(d,"P",{class:!0,"data-svelte-h":!0}),j(g)!=="svelte-1gtbz8v"&&(g.textContent=h),m=E(d),M(n.$$.fragment,d),c=E(d),_=x(d,"DIV",{class:!0});var z=N(_);M(r.$$.fragment,z),z.forEach(v),d.forEach(v),this.h()},h(){I(s,"class","svelte-1uau5oz"),I(f,"class","svelte-1uau5oz"),I(g,"class","svelte-1uau5oz"),I(_,"class","progress-bar svelte-1uau5oz"),X(_,"hidden",l[2]===0),I(e,"class","dialog svelte-1uau5oz")},m(p,d){T(p,e,d),b(e,s),b(e,i),b(e,f),b(e,a),b(e,g),b(e,m),U(n,e,null),b(e,c),b(e,_),U(r,_,null),C=!0},p(p,d){const z={};d&514&&(z.$$scope={dirty:d,ctx:p}),n.$set(z);const u={};!P&&d&4&&(P=!0,u.value=p[2],ae(()=>P=!1)),r.$set(u),(!C||d&4)&&X(_,"hidden",p[2]===0)},i(p){C||(S(n.$$.fragment,p),S(r.$$.fragment,p),C=!0)},o(p){A(n.$$.fragment,p),A(r.$$.fragment,p),C=!1},d(p){p&&v(e),V(n),l[7](null),V(r)}}}function be(l){let e,s,o,i,f,t,a;s=new me({props:{$$slots:{default:[$e]},$$scope:{ctx:l}}});let g={$$slots:{default:[ve]},$$scope:{ctx:l}};i=new fe({props:g}),l[8](i);const h=l[5].default,m=Q(h,l,l[9],null);return{c(){e=w("div"),H(s.$$.fragment),o=D(),H(i.$$.fragment),f=D(),t=w("div"),m&&m.c(),this.h()},l(n){e=x(n,"DIV",{class:!0});var c=N(e);M(s.$$.fragment,c),o=E(c),M(i.$$.fragment,c),f=E(c),t=x(c,"DIV",{class:!0});var _=N(t);m&&m.l(_),_.forEach(v),c.forEach(v),this.h()},h(){I(t,"class","main svelte-1uau5oz"),I(e,"class","container svelte-1uau5oz")},m(n,c){T(n,e,c),U(s,e,null),b(e,o),U(i,e,null),b(e,f),b(e,t),m&&m.m(t,null),a=!0},p(n,[c]){const _={};c&513&&(_.$$scope={dirty:c,ctx:n}),s.$set(_);const r={};c&526&&(r.$$scope={dirty:c,ctx:n}),i.$set(r),m&&m.p&&(!a||c&512)&&Z(m,h,n,n[9],a?te(h,n[9],c,null):ee(n[9]),null)},i(n){a||(S(s.$$.fragment,n),S(i.$$.fragment,n),S(m,n),a=!0)},o(n){A(s.$$.fragment,n),A(i.$$.fragment,n),A(m,n),a=!1},d(n){n&&v(e),V(s),l[8](null),V(i),m&&m.d(n)}}}const Ce=/^tile_\d+_\d+@(1|0.5)x\.basis$/;function we(l,e,s){let o;se(l,q,r=>s(10,o=r));let{$$slots:i={},$$scope:f}=e,t,a="",g=0,h;async function m(r){var z;if(s(1,a=""),o.viewport===null){s(1,a="Error: App is not initialised. This shouldn't happen...");return}if(r.length===0)return;const P=(z=r.find(u=>!Ce.test(u.name)))==null?void 0:z.name;if(P!==void 0){s(1,a=`Invalid file name: ${P}`);return}const C=r.map(u=>{const $=u.name.slice(0,-7).split(/_|@/g),F=parseInt($[1]),R=parseInt($[2]),J=parseInt($[3]);return{x:F,y:R,resolution:J}}),k=Math.max(...C.map(u=>u.x))+1,y=Math.max(...C.map(u=>u.y))+1;if(C.length!==k*y){const u=[];for(let $=0;$<k;$++)for(let F=0;F<y;F++)C.find(R=>R.x===$&&R.y===F)===void 0&&u.push({x:$,y:F});s(1,a=`Some tiles are missing. First, do you intend to have ${k}x${y} tiles? If so, then you are missing these tiles: ${u.map($=>`(${$.x},${$.y})`).join(", ")}`);return}const p=await ue(r.map(u=>({file:u,name:u.name})),2,u=>{h.set(u)}),d=p.tiles.map(u=>{const $=ie.from(pe(u.image));return $.x=u.x*p.tileWidth,$.y=u.y*p.tileHeight,$});o.viewport.children[0].removeChildren().forEach(u=>u.destroy(!0)),o.viewport.children[0].addChild(...d),W(q,o.viewport.worldWidth=k*p.tileWidth,o),W(q,o.viewport.worldHeight=y*p.tileHeight,o),o.viewport.centerViewport()}function n(r){g=r,s(2,g)}function c(r){B[r?"unshift":"push"](()=>{h=r,s(3,h)})}function _(r){B[r?"unshift":"push"](()=>{t=r,s(0,t)})}return l.$$set=r=>{"$$scope"in r&&s(9,f=r.$$scope)},[t,a,g,h,m,i,n,c,_,f]}class Ae extends oe{constructor(e){super(),ne(this,e,we,be,K,{})}}export{Ae as component};
