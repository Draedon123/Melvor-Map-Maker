import{a as K,c as Q,u as Z,g as ee,b as te,f as se,h as R,d as q,j as ae}from"../chunks/scheduler.CWFRzsjZ.js";import{S as oe,i as ne,e as w,c as k,s as y,a as I,b as A,d as H,f as S,g as v,h as x,j as M,m as V,k as h,t as P,l as U,n as N,o as G,p as J,q as le,r as O,u as X,v as re}from"../chunks/index.BXGTNUih.js";import{b as ie}from"../chunks/paths.Dl56lNOo.js";import{s as j,S as ue}from"../chunks/store.C2j4PXn_.js";import{f as pe}from"../chunks/imageUtils.Ch6fHfqa.js";import{T as fe,D as de,a as ce}from"../chunks/ToolbarItem.DyEiok1T.js";import{D as me,P as ge}from"../chunks/ProgressBar.BK1PlImH.js";function _e(l){let e;return{c(){e=G("Upload Map Images")},l(t){e=J(t,"Upload Map Images")},m(t,u){M(t,e,u)},d(t){t&&v(e)}}}function he(l){var u;let e,t;return e=new ce({props:{imageSRC:ie+"/upload.png",imageAltText:"An upload icon",imageOnClick:(u=l[0])==null?void 0:u.toggle,$$slots:{default:[_e]},$$scope:{ctx:l}}}),{c(){k(e.$$.fragment)},l(s){H(e.$$.fragment,s)},m(s,p){V(e,s,p),t=!0},p(s,p){var r;const n={};p&1&&(n.imageOnClick=(r=s[0])==null?void 0:r.toggle),p&512&&(n.$$scope={dirty:p,ctx:s}),e.$set(n)},i(s){t||(P(e.$$.fragment,s),t=!0)},o(s){U(e.$$.fragment,s),t=!1},d(s){N(e,s)}}}function $e(l){let e,t=`Drag and drop your .basis files here (in 1 go), or click to upload a
          file.`,u,s,p;return{c(){e=w("p"),e.textContent=t,u=y(),s=w("span"),p=G(l[1]),this.h()},l(n){e=I(n,"P",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-bqoe3f"&&(e.textContent=t),u=S(n),s=I(n,"SPAN",{class:!0});var r=A(s);p=J(r,l[1]),r.forEach(v),this.h()},h(){x(e,"class","svelte-1uau5oz"),x(s,"class","error svelte-1uau5oz")},m(n,r){M(n,e,r),M(n,u,r),M(n,s,r),h(s,p)},p(n,r){r&2&&re(p,n[1])},d(n){n&&(v(e),v(u),v(s))}}}function ve(l){let e,t,u="Upload Map Images",s,p,n="The map images must be in the format: tile_(x)_(y)@(1x OR 0.5x).basis",r,_,$="ie, tile_3_5@0.5x.basis",m,a,d,g,o,T,b;a=new me({props:{mimeType:".basis",multiple:!0,onFileUpload:l[4],$$slots:{default:[$e]},$$scope:{ctx:l}}});function D(i){l[6](i)}let E={containerStyles:{"border-color":"red"}};return l[2]!==void 0&&(E.value=l[2]),o=new ge({props:E}),q.push(()=>le(o,"value",D)),l[7](o),{c(){e=w("div"),t=w("h1"),t.textContent=u,s=y(),p=w("p"),p.textContent=n,r=y(),_=w("p"),_.textContent=$,m=y(),k(a.$$.fragment),d=y(),g=w("div"),k(o.$$.fragment),this.h()},l(i){e=I(i,"DIV",{class:!0});var f=A(e);t=I(f,"H1",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-d8o6tz"&&(t.textContent=u),s=S(f),p=I(f,"P",{class:!0,"data-svelte-h":!0}),O(p)!=="svelte-1xw0nlr"&&(p.textContent=n),r=S(f),_=I(f,"P",{class:!0,"data-svelte-h":!0}),O(_)!=="svelte-1gtbz8v"&&(_.textContent=$),m=S(f),H(a.$$.fragment,f),d=S(f),g=I(f,"DIV",{class:!0});var z=A(g);H(o.$$.fragment,z),z.forEach(v),f.forEach(v),this.h()},h(){x(t,"class","svelte-1uau5oz"),x(p,"class","svelte-1uau5oz"),x(_,"class","svelte-1uau5oz"),x(g,"class","progress-bar svelte-1uau5oz"),X(g,"hidden",l[2]===0),x(e,"class","dialog svelte-1uau5oz")},m(i,f){M(i,e,f),h(e,t),h(e,s),h(e,p),h(e,r),h(e,_),h(e,m),V(a,e,null),h(e,d),h(e,g),V(o,g,null),b=!0},p(i,f){const z={};f&514&&(z.$$scope={dirty:f,ctx:i}),a.$set(z);const W={};!T&&f&4&&(T=!0,W.value=i[2],ae(()=>T=!1)),o.$set(W),(!b||f&4)&&X(g,"hidden",i[2]===0)},i(i){b||(P(a.$$.fragment,i),P(o.$$.fragment,i),b=!0)},o(i){U(a.$$.fragment,i),U(o.$$.fragment,i),b=!1},d(i){i&&v(e),N(a),l[7](null),N(o)}}}function be(l){let e,t,u,s,p,n,r;t=new fe({props:{$$slots:{default:[he]},$$scope:{ctx:l}}});let _={$$slots:{default:[ve]},$$scope:{ctx:l}};s=new de({props:_}),l[8](s);const $=l[5].default,m=Q($,l,l[9],null);return{c(){e=w("div"),k(t.$$.fragment),u=y(),k(s.$$.fragment),p=y(),n=w("div"),m&&m.c(),this.h()},l(a){e=I(a,"DIV",{class:!0});var d=A(e);H(t.$$.fragment,d),u=S(d),H(s.$$.fragment,d),p=S(d),n=I(d,"DIV",{class:!0});var g=A(n);m&&m.l(g),g.forEach(v),d.forEach(v),this.h()},h(){x(n,"class","main svelte-1uau5oz"),x(e,"class","container svelte-1uau5oz")},m(a,d){M(a,e,d),V(t,e,null),h(e,u),V(s,e,null),h(e,p),h(e,n),m&&m.m(n,null),r=!0},p(a,[d]){const g={};d&513&&(g.$$scope={dirty:d,ctx:a}),t.$set(g);const o={};d&526&&(o.$$scope={dirty:d,ctx:a}),s.$set(o),m&&m.p&&(!r||d&512)&&Z(m,$,a,a[9],r?te($,a[9],d,null):ee(a[9]),null)},i(a){r||(P(t.$$.fragment,a),P(s.$$.fragment,a),P(m,a),r=!0)},o(a){U(t.$$.fragment,a),U(s.$$.fragment,a),U(m,a),r=!1},d(a){a&&v(e),N(t),l[8](null),N(s),m&&m.d(a)}}}const Ce=/^tile_\d+_\d+@(1|0.5)x\.basis$/;function we(l,e,t){let u;se(l,j,o=>t(10,u=o));let{$$slots:s={},$$scope:p}=e,n,r="",_=0,$;async function m(o){var L;if(u.viewport===null){t(1,r="Error: App is not initialised. This shouldn't happen...");return}const T=(L=o.find(c=>!Ce.test(c.name)))==null?void 0:L.name;if(T!==void 0){t(1,r=`Invalid file name: ${T}`);return}const b=o.map(c=>{const C=c.name.slice(0,-7).split(/_|@/g),F=parseInt(C[1]),B=parseInt(C[2]),Y=parseInt(C[3]);return{x:F,y:B,resolution:Y}}),D=Math.max(...b.map(c=>c.x))+1,E=Math.max(...b.map(c=>c.y))+1;if(b.length!==D*E){const c=[];for(let C=0;C<D;C++)for(let F=0;F<E;F++)b.find(B=>B.x===C&&B.y===F)===void 0&&c.push({x:C,y:F});t(1,r=`Some tiles are missing. First, do you intend to have ${D}x${E} tiles? If so, then you are missing these tiles: ${c.map(C=>JSON.stringify(C)).join(", ")}`);return}const i=await pe(o.map(c=>({file:c,name:c.name})),2,c=>{$.set(c)}),f=document.createElement("canvas"),z=f.getContext("2d");if(z===null)throw new Error("[Map Builder +layout.svelte onFileUpload] | Could not get 2d canvas rendering context");f.width=i.tileWidth*D,f.height=i.tileHeight*E;for(const c of i.tiles)z.drawImage(c.image,c.x*i.tileWidth,c.y*i.tileHeight,i.tileWidth,i.tileHeight);const W=ue.from(f);u.viewport.children[0].removeChildren().forEach(c=>c.destroy(!0)),u.viewport.children[0].addChild(W),R(j,u.viewport.worldWidth=D*i.tileWidth,u),R(j,u.viewport.worldHeight=E*i.tileHeight,u),u.viewport.centerViewport()}function a(o){_=o,t(2,_)}function d(o){q[o?"unshift":"push"](()=>{$=o,t(3,$)})}function g(o){q[o?"unshift":"push"](()=>{n=o,t(0,n)})}return l.$$set=o=>{"$$scope"in o&&t(9,p=o.$$scope)},[n,r,_,$,m,s,a,d,g,p]}class Te extends oe{constructor(e){super(),ne(this,e,we,be,K,{})}}export{Te as component};
