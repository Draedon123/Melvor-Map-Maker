import{a as p,t as w,d as X}from"../chunks/disclose-version.pAZcs84n.js";import{h as k,a as le,a6 as ue,b as fe,aL as de,l as M,j as R,q as ve,ag as Y,f as me,B as z,A as F,ap as J,aD as V,aM as ee,g as D,p as L,aG as pe,K as _e,W as ae,a5 as A,a1 as C,a4 as I,_ as j,Y as c,Z as G,$ as T,X as se,O as $,a0 as S,a2 as ge,aw as be}from"../chunks/utils.BRJKUTqf.js";import{h as je}from"../chunks/svelte-head.Bh-irVxV.js";import{d as we,s as ne,f as re,e as oe,i as te}from"../chunks/store.BTSVGJLy.js";import{e as xe}from"../chunks/each.DdoAzWFW.js";import{a as O,f as Ce}from"../chunks/imageUtils.CboFgM1z.js";import{b as ie}from"../chunks/this.BvguKOfU.js";import{s as E}from"../chunks/render.j7FqK5Uc.js";import{p as Ie}from"../chunks/props.BlxC-9-v.js";import{P as ce,s as K}from"../chunks/store.cGEaFj6u.js";import{D as Ue}from"../chunks/Dialog.ByOQsEJR.js";import{d as he,l as Pe}from"../chunks/database.CtsHh3PR.js";import{b as q}from"../chunks/paths.BXsdQ0-J.js";import{o as He}from"../chunks/index-client.DGISRjzp.js";const N=0,y=1,B=2;function Re(_,e,t,n,a){k&&le();var h=_,d=ue(),g=_e,i=Y,l,v,m,x=(d?z:F)(void 0),s=(d?z:F)(void 0),r=!1;function f(u,o){r=!0,o&&(J(b),V(b),ee(g));try{u===N&&t&&(l?D(l):l=R(()=>t(h))),u===y&&n&&(v?D(v):v=R(()=>n(h,x))),u===B&&a&&(m?D(m):m=R(()=>a(h,s))),u!==N&&l&&L(l,()=>l=null),u!==y&&v&&L(v,()=>v=null),u!==B&&m&&L(m,()=>m=null)}finally{o&&(ee(null),V(null),J(null),pe())}}var b=fe(()=>{if(i!==(i=e())){if(de(i)){var u=i;r=!1,u.then(o=>{u===i&&(M(x,o),f(y,!0))},o=>{if(u===i)throw M(s,o),f(B,!0),s.v}),k?t&&(l=R(()=>t(h))):ve(()=>{r||f(N,!0)})}else M(x,i),f(y,!1);return()=>i=Y}});k&&(h=me)}async function ye(_,e,t,n,a){if(c(e)!==void 0){if(c(t)){c(e).close(),await he.projects.delete(n.project.id),a().activeProject===n.project&&re(K,$(a).activeProject=new ce,$(a));return}G(t,!0)}}async function Ae(_,e,t,n){re(K,$(e).activeProject=await ce.fromDatabaseProject(t.project),$(e)),c(n)!==void 0&&c(n).close()}var $e=(_,e)=>{var t;(t=c(e))==null||t.open()},We=w('<img alt="Project thumbnail" class="thumbnail svelte-1x0n754">'),ke=w("<p>Image loading...</p>"),Me=w('<div class="dialog svelte-1x0n754"><h1 class="svelte-1x0n754"> </h1> <button class="delete-button svelte-1x0n754"> </button> <button class="svelte-1x0n754">Open</button> <button class="svelte-1x0n754">Close</button></div>'),De=w('<button class="project exclude-global svelte-1x0n754"><h3 class="svelte-1x0n754"> </h3> <!></button> <!>',1);function Le(_,e){ae(e,!0);const t=ne(),n=()=>oe(K,"$store",t);let a=S(void 0),h=S(!1),d=ge(()=>e.project.thumbnail!==null?Ce(e.project.thumbnail.buffer):new Promise(s=>{const r=new Image;r.onload=()=>{s(r)},r.src=`${q}/no_image.png`}));var g=De(),i=A(g);i.__click=[$e,a];var l=C(i),v=C(l,!0);I(l);var m=j(l,2);Re(m,()=>c(d),s=>{var r=ke();p(s,r)},(s,r)=>{var f=We();T(()=>O(f,"src",c(r).src)),p(s,f)}),I(i);var x=j(i,2);ie(Ue(x,{showDefaultCloseButton:!1,children:(s,r)=>{var f=Me(),b=C(f),u=C(b,!0);I(b);var o=j(b,2);o.__click=[ye,a,h,e,n];var U=C(o,!0);I(o);var H=j(o,2);H.__click=[Ae,n,e,a];var P=j(H,2);P.__click=function(...W){var Q;(Q=c(a).close)==null||Q.apply(this,W)},I(f),T(()=>{E(u,e.project.name??"Unnamed Project"),E(U,c(h)?"Are you sure?":"Delete")}),p(s,f)},$$slots:{default:!0}}),s=>G(a,Ie(s)),()=>c(a)),T(()=>{O(i,"aria-label",`Project: ${e.project.name??"Unnamed Project"??""}`),E(v,e.project.name??"Unnamed Project")}),p(_,g),se()}we(["click"]);class Z{constructor(e="",t=!0){this.hash=e,this.autoUpdateWindowHash=t}static fromWindow(e=!0){return new Z(window.location.hash.slice(1),e)}updateWindowHash(){return window.location.hash=this.hash===""?"":`#${this.hash}`,this.hash}get(e){return this.getAllHashes()[e]??null}set(e,t){const n=this.getHashString(e,t);return this.contains(e)?this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),`${n},`):(this.hash!==""&&(this.hash+=","),this.hash+=`${n}`),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),this.hash}delete(e){if(!this.contains(e))return null;const t=this.get(e);return this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),",").replace(/,+/,","),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),t}contains(e){return new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`).test(this.hash)}getAllHashes(){const e=this.hash.split(","),t={};for(const n of e){if(n==="")continue;const a=n.split("="),h=decodeURIComponent(a[0]),d=decodeURIComponent(a[1]);t[h]=d}return t}getHashString(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`}removeLeadingAndTrailingCommas(){var n,a,h,d;if(!this.hash.startsWith(",")&&!this.hash.endsWith(","))return this.hash;const e=((a=(n=this.hash.match(/^,+/))==null?void 0:n[0])==null?void 0:a.length)??0,t=-(((d=(h=this.hash.match(/,+$/))==null?void 0:h[0])==null?void 0:d.length)??-this.hash.length);return this.hash=this.hash.slice(e,t),this.hash}}var Te=w(`<style lang="scss">body {
  margin: 0;
  overflow: hidden;
  min-width: 100vw;
  min-height: 100vh;
}</style>`),Ee=w(`<h3 class="svelte-act1aa">No existing projects! Create a new project with CTRL + K! An actual
          interface is coming Soon™️</h3>`),Ne=w("<p>Loading projects...</p>"),Be=w('<h1 class="svelte-act1aa">Melvor Map Maker</h1> <a class="svelte-act1aa"></a> <div class="projects svelte-act1aa"><h2>Saved Projects</h2> <div class="project-container svelte-act1aa"><!></div></div>',1);function tt(_,e){ae(e,!0);const t=ne(),n=()=>oe(h,"$projects",t);let a=S(void 0),h=Pe(()=>he.projects.toArray());He(()=>{if(c(a)===void 0)return;const r=Z.fromWindow().get("route");r!==null&&(c(a).href=`${q}/${r}`,c(a).click())});var d=Be();je(s=>{var r=Te();be.title="Melvor Map Maker",p(s,r)});var g=j(A(d),2);O(g,"href",q),ie(g,s=>G(a,s),()=>c(a));var i=j(g,2),l=j(C(i),2),v=C(l);{var m=s=>{var r=X(),f=A(r);{var b=o=>{var U=X(),H=A(U);xe(H,1,n,P=>P.id,(P,W)=>{Le(P,{get project(){return c(W)}})}),p(o,U)},u=o=>{var U=Ee();p(o,U)};te(f,o=>{n().length>0?o(b):o(u,!1)})}p(s,r)},x=s=>{var r=Ne();p(s,r)};te(v,s=>{n()!==void 0?s(m):s(x,!1)})}I(l),I(i),p(_,d),se()}export{tt as component};
