import{B as ee,C as te,x as T,m as se,r as ne,a as N,n as M,e as B,f as ae,o as le,d as ce}from"../chunks/scheduler.CWFRzsjZ.js";import{z as O,l as D,x as X,t as V,S as Y,i as Z,e as x,o as he,s as W,a as H,b as L,p as re,g as v,f as A,r as S,h as w,j,k as U,v as oe,B as ie,w as G,c as ue,d as de,m as pe,n as me}from"../chunks/index.BXGTNUih.js";import{b as q}from"../chunks/paths.13jeK2Xb.js";import{l as fe,d as _e}from"../chunks/database.BAragyFV.js";import{a as ge}from"../chunks/imageUtils.BEg_kVKh.js";function Q(n,e){const s=e.token={};function t(l,a,r,d){if(e.token!==s)return;e.resolved=d;let o=e.ctx;r!==void 0&&(o=o.slice(),o[r]=d);const f=l&&(e.current=l)(o);let p=!1;e.block&&(e.blocks?e.blocks.forEach((_,h)=>{h!==a&&_&&(O(),D(_,1,1,()=>{e.blocks[h]===_&&(e.blocks[h]=null)}),X())}):e.block.d(1),f.c(),V(f,1),f.m(e.mount(),e.anchor),p=!0),e.block=f,e.blocks&&(e.blocks[a]=f),p&&se()}if(ee(n)){const l=te();if(n.then(a=>{T(l),t(e.then,1,e.value,a),T(null)},a=>{if(T(l),t(e.catch,2,e.error,a),T(null),!e.hasCatch)throw a}),e.current!==e.pending)return t(e.pending,0),!0}else{if(e.current!==e.then)return t(e.then,1,e.value,n),!0;e.resolved=n}}function ve(n,e,s){const t=e.slice(),{resolved:l}=n;n.current===n.then&&(t[n.value]=l),n.current===n.catch&&(t[n.error]=l),n.block.p(t,s)}function F(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function we(n,e){D(n,1,1,()=>{e.delete(n.key)})}function be(n,e,s,t,l,a,r,d,o,f,p,_){let h=n.length,u=a.length,b=h;const I={};for(;b--;)I[n[b].key]=b;const C=[],y=new Map,c=new Map,i=[];for(b=u;b--;){const m=_(l,a,b),k=s(m);let $=r.get(k);$?i.push(()=>$.p(m,e)):($=f(k,m),$.c()),y.set(k,C[b]=$),k in I&&c.set(k,Math.abs(b-I[k]))}const g=new Set,E=new Set;function R(m){V(m,1),m.m(d,p),r.set(m.key,m),p=m.first,u--}for(;h&&u;){const m=C[u-1],k=n[h-1],$=m.key,P=k.key;m===k?(p=m.first,h--,u--):y.has(P)?!r.has($)||g.has($)?R(m):E.has(P)?h--:c.get($)>c.get(P)?(E.add($),R(m)):(g.add(P),h--):(o(k,r),h--)}for(;h--;){const m=n[h];y.has(m.key)||o(m,r)}for(;u;)R(C[u-1]);return ne(i),C}function Ce(n){return{c:M,l:M,m:M,p:M,d:M}}function ke(n){let e,s;return{c(){e=x("img"),this.h()},l(t){e=H(t,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){B(e.src,s=n[1].src)||w(e,"src",s),w(e,"alt","Thumbnail"),w(e,"class","thumbnail svelte-1npg1hj")},m(t,l){j(t,e,l)},p(t,l){l&2&&!B(e.src,s=t[1].src)&&w(e,"src",s)},d(t){t&&v(e)}}}function $e(n){let e,s="Image loading...";return{c(){e=x("p"),e.textContent=s},l(t){e=H(t,"P",{"data-svelte-h":!0}),S(e)!=="svelte-9u03uz"&&(e.textContent=s)},m(t,l){j(t,e,l)},p:M,d(t){t&&v(e)}}}function je(n){let e,s,t=(n[0].name??"Unnamed Project")+"",l,a,r,d,o,f="asd",p={ctx:n,current:null,token:null,hasCatch:!1,pending:$e,then:ke,catch:Ce,value:1};return Q(r=n[1],p),{c(){e=x("div"),s=x("h3"),l=he(t),a=W(),p.block.c(),d=W(),o=x("div"),o.textContent=f,this.h()},l(_){e=H(_,"DIV",{class:!0});var h=L(e);s=H(h,"H3",{class:!0});var u=L(s);l=re(u,t),u.forEach(v),a=A(h),p.block.l(h),d=A(h),o=H(h,"DIV",{class:!0,"data-svelte-h":!0}),S(o)!=="svelte-1lls3la"&&(o.textContent=f),h.forEach(v),this.h()},h(){w(s,"class","svelte-1npg1hj"),w(o,"class","footer svelte-1npg1hj"),w(e,"class","project svelte-1npg1hj")},m(_,h){j(_,e,h),U(e,s),U(s,l),U(e,a),p.block.m(e,p.anchor=null),p.mount=()=>e,p.anchor=d,U(e,d),U(e,o)},p(_,[h]){n=_,h&1&&t!==(t=(n[0].name??"Unnamed Project")+"")&&oe(l,t),p.ctx=n,h&2&&r!==(r=n[1])&&Q(r,p)||ve(p,n,h)},i:M,o:M,d(_){_&&v(e),p.block.d(),p.token=null,p=null}}}function xe(n,e,s){let t,{project:l}=e;return n.$$set=a=>{"project"in a&&s(0,l=a.project)},n.$$.update=()=>{n.$$.dirty&1&&s(1,t=l.thumbnail!==null?ge(l.thumbnail.buffer):new Promise(a=>{const r=new Image;r.onload=()=>{a(r)},r.src=`${q}/no_image.png`}))},[l,t]}class He extends Y{constructor(e){super(),Z(this,e,xe,je,N,{project:0})}}class z{constructor(e="",s=!0){this.hash=e,this.autoUpdateWindowHash=s}static fromWindow(e=!0){return new z(window.location.hash.slice(1),e)}updateWindowHash(){return window.location.hash=this.hash===""?"":`#${this.hash}`,this.hash}get(e){return this.getAllHashes()[e]??null}set(e,s){const t=this.getHashString(e,s);return this.contains(e)?this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),`${t},`):(this.hash!==""&&(this.hash+=","),this.hash+=`${t}`),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),this.hash}delete(e){if(!this.contains(e))return null;const s=this.get(e);return this.hash=this.hash.replace(new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`),",").replace(/,+/,","),this.removeLeadingAndTrailingCommas(),this.autoUpdateWindowHash&&this.updateWindowHash(),s}contains(e){return new RegExp(`(${encodeURIComponent(e)}=.+?,)|(${encodeURIComponent(e)}=.+?$)`).test(this.hash)}getAllHashes(){const e=this.hash.split(","),s={};for(const t of e){if(t==="")continue;const l=t.split("="),a=decodeURIComponent(l[0]),r=decodeURIComponent(l[1]);s[a]=r}return s}getHashString(e,s){return`${encodeURIComponent(e)}=${encodeURIComponent(s)}`}removeLeadingAndTrailingCommas(){var t,l,a,r;if(!this.hash.startsWith(",")&&!this.hash.endsWith(","))return this.hash;const e=((l=(t=this.hash.match(/^,+/))==null?void 0:t[0])==null?void 0:l.length)??0,s=-(((r=(a=this.hash.match(/,+$/))==null?void 0:a[0])==null?void 0:r.length)??-this.hash.length);return this.hash=this.hash.slice(e,s),this.hash}}function J(n,e,s){const t=n.slice();return t[4]=e[s],t}function K(n,e){let s,t,l;return t=new He({props:{project:e[4]}}),{key:n,first:null,c(){s=G(),ue(t.$$.fragment),this.h()},l(a){s=G(),de(t.$$.fragment,a),this.h()},h(){this.first=s},m(a,r){j(a,s,r),pe(t,a,r),l=!0},p(a,r){e=a;const d={};r&2&&(d.project=e[4]),t.$set(d)},i(a){l||(V(t.$$.fragment,a),l=!0)},o(a){D(t.$$.fragment,a),l=!1},d(a){a&&v(s),me(t,a)}}}function Ie(n){let e,s,t="Melvor Map Maker",l,a,r="",d,o,f,p="Saved Projects",_,h,u=[],b=new Map,I,C=F(n[1]??[]);const y=c=>c[4].id;for(let c=0;c<C.length;c+=1){let i=J(n,C,c),g=y(i);b.set(g,u[c]=K(g,i))}return{c(){e=W(),s=x("h1"),s.textContent=t,l=W(),a=x("a"),a.innerHTML=r,d=W(),o=x("div"),f=x("h2"),f.textContent=p,_=W(),h=x("div");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){ie("svelte-1bq5zbc",document.head).forEach(v),e=A(c),s=H(c,"H1",{class:!0,"data-svelte-h":!0}),S(s)!=="svelte-1w6u9bb"&&(s.textContent=t),l=A(c),a=H(c,"A",{href:!0,class:!0,"data-svelte-h":!0}),S(a)!=="svelte-1vm4tsh"&&(a.innerHTML=r),d=A(c),o=H(c,"DIV",{class:!0});var g=L(o);f=H(g,"H2",{"data-svelte-h":!0}),S(f)!=="svelte-1cctxi5"&&(f.textContent=p),_=A(g),h=H(g,"DIV",{class:!0});var E=L(h);for(let R=0;R<u.length;R+=1)u[R].l(E);E.forEach(v),g.forEach(v),this.h()},h(){document.title="Melvor Map Maker",w(s,"class","svelte-1742yfi"),w(a,"href",q),w(a,"class","svelte-1742yfi"),w(h,"class","project-container svelte-1742yfi"),w(o,"class","projects svelte-1742yfi")},m(c,i){j(c,e,i),j(c,s,i),j(c,l,i),j(c,a,i),n[3](a),j(c,d,i),j(c,o,i),U(o,f),U(o,_),U(o,h);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(h,null);I=!0},p(c,[i]){i&2&&(C=F(c[1]??[]),O(),u=be(u,i,y,1,c,C,b,h,we,K,null,J),X())},i(c){if(!I){for(let i=0;i<C.length;i+=1)V(u[i]);I=!0}},o(c){for(let i=0;i<u.length;i+=1)D(u[i]);I=!1},d(c){c&&(v(e),v(s),v(l),v(a),v(d),v(o)),n[3](null);for(let i=0;i<u.length;i+=1)u[i].d()}}}function Me(n,e,s){let t,l,a=fe(()=>_e.projects.toArray());ae(n,a,d=>s(1,t=d)),le(()=>{const o=z.fromWindow().get("route");o!==null&&(s(0,l.href=`${q}/${o}`,l),l.click())});function r(d){ce[d?"unshift":"push"](()=>{l=d,s(0,l)})}return[l,t,a,r]}class Ee extends Y{constructor(e){super(),Z(this,e,Me,Ie,N,{})}}export{Ee as component};
